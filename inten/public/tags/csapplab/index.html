<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CSAPPLAB | intenのblog🍦</title><meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://inten.kro1lsec.com/tags/csapplab/><link crossorigin=anonymous href=/assets/css/stylesheet.min.84cc6e7cd97516a4d4e877c6bebe5a4529afdf61f4d009e2c8bbec3a876fff4e.css integrity="sha256-hMxufNl1FqTU6HfGvr5aRSmv32H00AniyLvsOodv/04=" rel="preload stylesheet" as=style><link rel=icon href=https://inten.kro1lsec.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://inten.kro1lsec.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://inten.kro1lsec.com/favicon-32x32.png><link rel=apple-touch-icon href=https://inten.kro1lsec.com/apple-touch-icon.png><link rel=mask-icon href=https://inten.kro1lsec.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><link rel=alternate type=application/rss+xml href=https://inten.kro1lsec.com/tags/csapplab/index.xml><meta property="og:title" content="CSAPPLAB"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://inten.kro1lsec.com/tags/csapplab/"><meta name=twitter:card content="summary"><meta name=twitter:title content="CSAPPLAB"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://inten.kro1lsec.com/ accesskey=h title="intenのblog🍦 (Alt + H)">intenのblog🍦</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://inten.kro1lsec.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://inten.kro1lsec.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://inten.kro1lsec.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>CSAPPLAB</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>[CSAPPLAB]Attack Lab</h2></header><section class=entry-content><p>ctarget 首先执行getbuf函数，读取标准输入。
unsigned getbuf() { char buf[BUFFER_SIZE]; Gets(buf); return 1; } 参数 (ctarget和rtarget都有) -q 不发送成绩 -i 从文件中输入 如果你没有使用-q，就会出现
FAILED: Initialization error: Running on an illegal host [localhost.localdomain] 因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。
1.1level 1 观察test，getbuf和touch1
目的：将getbuf的返回地址由test改为touch1
小建议
利用objdump -d ./ctarget>>ctarget.s得到汇编代码 思路是将touch1的开始地址，放在某个位置，以实现当ret指令被getbuf执行后会将控制权转移给touch1 一定要注意字节序 你可以使用gdb设置断点来进行调试。并且gcc会影响栈帧中buf存放的位置。需要注意 思路：getbuf函数执行ret指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。
(gdb) p (char*)0x403188 #p(print) 0x403188上存的值 $1 = 0x403188 "No exploit. Getbuf returned 0x%x\n" stack : padding(00..) + touch1(0x4017c0)
攻击序列touch1.txt
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c0 17 40 00 00 00 00 00 保存在touch1....</p></section><footer class=entry-footer>May 20, 2021&nbsp;·&nbsp;5 min</footer><a class=entry-link aria-label="post link to [CSAPPLAB]Attack Lab" href=https://inten.kro1lsec.com/post/csapplabattack-lab/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>[CSAPPLAB]Bomb Lab</h2></header><section class=entry-content><p>总体感觉考查对汇编的理解和熟练度
phase_1 400e37: 48 89 c7 mov %rax,%rdi //第一个参数 400e3a: e8 a1 00 00 00 callq 400ee0 &lt;phase_1>
...
0x0000000000400ee0 &lt;+0>: sub $0x8,%rsp 0x0000000000400ee4 &lt;+4>: mov $0x402400,%esi //第二个参数
0x0000000000400ee9 &lt;+9>: callq 0x401338 &lt;strings_not_equal>
让参数一，二相等即可
Border relations with Canada have never been better.
phase_2 利用callq 0x40145c &lt;read_six_numbers>确定字符串格式，
利用0000000000400F1A add eax, eax让后边的数翻倍
字符串为“1 2 4 8 16 32”
phase_3 尝试分析时，发现jcc指令经常弄混，又回去复习了一遍
cmp oprd1,oprd2 + JNBE/JA 无符号
cmp oprd1,oprd2 + JNLE/JG 有符号
oprd1>oprd2时跳转
JZ/JE 相等则跳转
代码中0x402470+8*第一参数打印内存信息，可以看到相应的跳转地址，已经对应的eax值应该是多少，也就是第二数字的应该的取值。打印内存信息的命令行为jmp QWORD PTR [rax*8+0x402470]...</p></section><footer class=entry-footer>April 15, 2021&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to [CSAPPLAB]Bomb Lab" href=https://inten.kro1lsec.com/post/csapplabbomb-lab/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>[CSAPPLAB]Data lab</h2></header><section class=entry-content><p>前置知识 csapp第二章
位运算符
运算符 描述 实例 & 按位与操作，按二进制位进行"与"运算。运算规则：0&0=0; 0&1=0; 1&0=0; 1&1=1; (A & B) 将得到 12，即为 0000 1100 | 按位或运算符，按二进制位进行"或"运算。运算规则：`0 0=0; 0 ^ 异或运算符，按二进制位进行"异或"运算。运算规则：0^0=0; 0^1=1; 1^0=1; 1^1=0; (A ^ B) 将得到 49，即为 0011 0001 ~ 取反运算符，按二进制位进行"取反"运算。运算规则：~1=-2; ~0=-1; (~A ) 将得到 -61，即为 1100 0011，一个有符号二进制数的补码形式。 « 二进制左移运算符。将一个运算对象的各二进制位全部左移若干位（左边的二进制位丢弃，右边补0）。 A « 2 将得到 240，即为 1111 0000 » 二进制右移运算符。将一个数的各二进制位全部右移若干位，正数左补0，负数左补1，右边丢弃。 A » 2 将得到 15，即为 0000 1111 运算符的优先级...</p></section><footer class=entry-footer>April 11, 2021&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to [CSAPPLAB]Data lab" href=https://inten.kro1lsec.com/post/csapplabdata-lab/></a></article></main><footer class=footer><span>&copy; 2021 <a href=https://inten.kro1lsec.com/>intenのblog🍦</a></span>
<span>&#183;</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>